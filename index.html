<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>åŒ—æµ·é“2026</title>
<style>
:root{--ice:#e3f2fd;--blue:#1976d2;--navy:#0d47a1;--orange:#ff6d00;--red:#e53935;--purple:#7c4dff;--green:#00c853;--gray:#546e7a;--light:#90a4ae;--bg:#f5f5f5}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{height:100%;overflow:hidden}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:var(--bg);color:#263238;font-size:16px;line-height:1.5}
.app{display:flex;flex-direction:column;height:100%;max-width:500px;margin:0 auto;background:#fff;box-shadow:0 0 20px rgba(0,0,0,.1)}
.header{background:linear-gradient(135deg,var(--blue),var(--navy));color:#fff;padding:12px 16px;display:flex;align-items:center;gap:10px;flex-shrink:0}
.header-icon{font-size:28px}
.header-title{font-size:18px;font-weight:700}
.header-sub{font-size:12px;opacity:.85}
.header-sync{margin-left:auto;background:rgba(255,255,255,.2);border:none;color:#fff;width:36px;height:36px;border-radius:50%;font-size:18px;cursor:pointer}
.header-sync.loading{animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.content{flex:1;overflow-y:auto;overflow-x:hidden;-webkit-overflow-scrolling:touch}
.page{display:none;padding:16px;padding-bottom:80px;min-height:100%}
.page.active{display:block}
.nav{position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:100%;max-width:500px;background:#fff;display:flex;border-top:1px solid #e0e0e0;box-shadow:0 -2px 10px rgba(0,0,0,.05);z-index:100}
.nav-item{flex:1;padding:8px 4px;text-align:center;color:var(--gray);text-decoration:none;transition:all .2s}
.nav-item.active{color:var(--blue)}
.nav-item span{display:block;font-size:22px;margin-bottom:2px}
.nav-item small{font-size:10px}
.card{background:#fff;border-radius:16px;margin-bottom:16px;box-shadow:0 2px 12px rgba(0,0,0,.08);overflow:hidden}
.card-header{padding:14px 16px;color:#fff;background:linear-gradient(135deg,var(--blue),var(--navy))}
.card-header.purple{background:linear-gradient(135deg,var(--purple),#512da8)}
.card-header.orange{background:linear-gradient(135deg,var(--orange),#f57c00)}
.card-header.green{background:linear-gradient(135deg,var(--green),#00e676)}
.card-title{font-size:17px;font-weight:700}
.card-sub{font-size:13px;opacity:.9;margin-top:2px}
.card-body{padding:16px}
.timeline{position:relative;padding-left:24px}
.timeline::before{content:'';position:absolute;left:7px;top:4px;bottom:4px;width:2px;background:linear-gradient(var(--ice),var(--blue))}
.tl-item{position:relative;padding-bottom:16px}
.tl-item:last-child{padding-bottom:0}
.tl-dot{position:absolute;left:-20px;top:4px;width:12px;height:12px;background:#fff;border:3px solid var(--blue);border-radius:50%}
.tl-item.meal .tl-dot{border-color:var(--orange)}
.tl-item.hotel .tl-dot{border-color:var(--purple)}
.tl-time{font-size:13px;color:var(--light);font-weight:500}
.tl-title{font-size:16px;font-weight:600;margin:2px 0}
.tl-desc{font-size:14px;color:var(--gray)}
.tl-link{display:inline-flex;align-items:center;gap:4px;margin-top:6px;padding:6px 12px;background:var(--ice);color:var(--blue);text-decoration:none;border-radius:20px;font-size:13px}
.day-selector{display:flex;gap:8px;overflow-x:auto;padding-bottom:16px;margin-bottom:16px;-webkit-overflow-scrolling:touch}
.day-selector::-webkit-scrollbar{display:none}
.day-btn{flex-shrink:0;width:50px;padding:12px 8px;background:#fff;border:2px solid #e0e0e0;border-radius:12px;text-align:center;cursor:pointer}
.day-btn.active{background:var(--blue);border-color:var(--blue);color:#fff}
.day-btn-num{font-size:18px;font-weight:700}
.day-btn-date{font-size:10px;opacity:.7;margin-top:2px}

.spot-card{background:#fff;border-radius:16px;margin-bottom:16px;box-shadow:0 2px 12px rgba(0,0,0,.08);overflow:hidden}
.spot-img{width:100%;height:180px;object-fit:cover;background:linear-gradient(135deg,#e3f2fd,#bbdefb)}
.spot-body{padding:16px}
.spot-region{display:inline-block;background:var(--blue);color:#fff;padding:4px 12px;border-radius:12px;font-size:12px;margin-bottom:10px}
.spot-name{font-size:20px;font-weight:700}
.spot-jp{font-size:14px;color:var(--light);margin-top:2px}
.spot-desc{font-size:15px;color:var(--gray);margin:12px 0;line-height:1.7}
.spot-info-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin:12px 0;padding:12px;background:var(--ice);border-radius:12px}
.spot-info-item{font-size:14px}
.spot-info-label{color:var(--light);font-size:12px}
.spot-info-value{font-weight:600;margin-top:2px}
.spot-tips{background:#fff3e0;border-radius:12px;padding:12px;margin:12px 0}
.spot-tips-title{font-size:13px;font-weight:600;color:var(--orange);margin-bottom:6px}
.spot-tips-content{font-size:14px;color:#795548;line-height:1.6}
.spot-nav-btn{display:flex;align-items:center;justify-content:center;gap:8px;width:100%;padding:14px;background:linear-gradient(135deg,var(--green),#00e676);color:#fff;border:none;border-radius:12px;font-size:16px;font-weight:600;cursor:pointer;margin-top:12px;text-decoration:none}
.spot-nav-btn:active{transform:scale(.98)}

.hotel-card{background:#fff;border-radius:16px;margin-bottom:12px;box-shadow:0 2px 12px rgba(0,0,0,.08);overflow:hidden}
.hotel-header{padding:12px 16px;color:#fff;background:linear-gradient(135deg,var(--purple),#512da8)}
.hotel-date{font-size:12px;opacity:.9}
.hotel-name{font-size:16px;font-weight:700;margin-top:2px}
.hotel-body{padding:14px 16px}
.hotel-info{font-size:14px;color:var(--gray);line-height:1.8}
.hotel-tags{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}
.hotel-tag{background:var(--ice);color:var(--blue);padding:4px 10px;border-radius:12px;font-size:13px}
.hotel-tag.warn{background:#fff3e0;color:#e65100}
.hotel-tag.no{background:#ffebee;color:#c62828}
.hotel-price{display:flex;justify-content:space-between;align-items:center;margin-top:12px;padding-top:12px;border-top:1px dashed #e0e0e0}
.hotel-price-label{font-size:14px;color:var(--gray)}
.hotel-price-value{font-size:20px;font-weight:700;color:var(--red)}

.trans-box{background:#fff;border-radius:16px;margin-bottom:12px;box-shadow:0 2px 12px rgba(0,0,0,.08);padding:16px}
.trans-title{font-size:16px;font-weight:700;margin-bottom:12px}
.trans-row{display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid #f0f0f0;font-size:15px}
.trans-row:last-child{border-bottom:none}
.trans-label{color:var(--gray)}
.trans-value{font-weight:600}
.trans-value.red{color:var(--red)}
.route-table{width:100%;border-collapse:collapse;font-size:14px;margin-top:12px}
.route-table th,.route-table td{padding:10px 8px;text-align:left}
.route-table thead{background:var(--ice)}
.route-table tbody tr{border-bottom:1px solid #f0f0f0}
.route-table tfoot{background:var(--navy);color:#fff}
.route-table td:last-child,.route-table th:last-child{text-align:right}

.phrase-tabs{display:flex;gap:8px;overflow-x:auto;padding-bottom:12px;margin-bottom:16px;-webkit-overflow-scrolling:touch}
.phrase-tabs::-webkit-scrollbar{display:none}
.phrase-tab{flex-shrink:0;padding:10px 16px;background:#fff;border:2px solid #e0e0e0;border-radius:25px;font-size:14px;color:var(--gray);cursor:pointer;white-space:nowrap}
.phrase-tab.active{background:var(--blue);border-color:var(--blue);color:#fff}
.phrase-card{background:#fff;border-radius:16px;margin-bottom:12px;padding:16px;box-shadow:0 2px 12px rgba(0,0,0,.08);border-left:4px solid var(--blue);cursor:pointer;transition:transform .1s}
.phrase-card:active{transform:scale(.98)}
.phrase-card.driving{border-color:var(--green)}
.phrase-card.restaurant{border-color:var(--orange)}
.phrase-card.onsen{border-color:#ffab91}
.phrase-card.shopping{border-color:var(--purple)}
.phrase-card.emergency{border-color:var(--red)}
.phrase-jp{font-size:18px;font-weight:700}
.phrase-romaji{font-size:13px;color:var(--light);font-style:italic;margin:4px 0}
.phrase-zh{font-size:15px;color:var(--gray)}
.phrase-play{display:flex;align-items:center;gap:6px;margin-top:10px;color:var(--blue);font-size:14px}

.budget-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:16px}
.budget-card{background:#fff;border-radius:16px;padding:14px 10px;text-align:center;box-shadow:0 2px 12px rgba(0,0,0,.08)}
.budget-card.total{grid-column:span 3;background:linear-gradient(135deg,var(--blue),var(--navy));color:#fff}
.budget-icon{font-size:24px;margin-bottom:4px}
.budget-label{font-size:12px;opacity:.7}
.budget-value{font-size:16px;font-weight:700;margin-top:2px}
.expense-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.expense-title{font-size:17px;font-weight:700}
.expense-add-btn{background:var(--green);color:#fff;border:none;padding:10px 20px;border-radius:25px;font-size:15px;font-weight:600;cursor:pointer}
.expense-status{display:flex;align-items:center;gap:6px;font-size:13px;padding:6px 12px;border-radius:20px;margin-bottom:12px}
.expense-status.online{background:#e8f5e9;color:#2e7d32}
.expense-status.offline{background:#fff3e0;color:#e65100}
.expense-status.error{background:#ffebee;color:#c62828}
.expense-cats{display:flex;gap:8px;overflow-x:auto;padding-bottom:12px;margin-bottom:12px;-webkit-overflow-scrolling:touch}
.expense-cats::-webkit-scrollbar{display:none}
.expense-cat{flex-shrink:0;padding:8px 14px;border-radius:20px;font-size:14px;cursor:pointer;white-space:nowrap}
.expense-cat.active{box-shadow:0 2px 8px rgba(0,0,0,.2)}
.expense-list{background:#fff;border-radius:16px;box-shadow:0 2px 12px rgba(0,0,0,.08);overflow:hidden}
.expense-item{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;border-bottom:1px solid #f0f0f0}
.expense-item:last-child{border-bottom:none}
.expense-item:active{background:#f5f5f5}
.expense-left{display:flex;align-items:center;gap:12px}
.expense-icon{width:40px;height:40px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:20px}
.expense-info{flex:1}
.expense-desc{font-size:15px;font-weight:500}
.expense-date{font-size:12px;color:var(--light);margin-top:2px}
.expense-amount{font-size:17px;font-weight:700}
.expense-amount.twd{color:var(--red)}
.expense-amount.jpy{color:var(--blue)}
.expense-delete{background:none;border:none;font-size:20px;color:var(--light);padding:8px;cursor:pointer}
.expense-empty{text-align:center;padding:40px 20px;color:var(--light)}

.info-card{background:#fff;border-radius:16px;margin-bottom:12px;box-shadow:0 2px 12px rgba(0,0,0,.08);overflow:hidden}
.info-header{padding:14px 16px;font-size:16px;font-weight:700;background:var(--ice)}
.info-body{padding:4px 0}
.info-row{display:flex;justify-content:space-between;padding:12px 16px;border-bottom:1px solid #f0f0f0;font-size:15px}
.info-row:last-child{border-bottom:none}
.info-label{color:var(--gray)}
.info-value{font-weight:500}
.emergency-box{background:var(--red);color:#fff;padding:16px;text-align:center;margin:12px 16px;border-radius:12px}
.emergency-box h4{font-size:13px;opacity:.9}
.emergency-box p{font-size:28px;font-weight:700;margin-top:4px}

.setup-card{background:#fff;border-radius:16px;padding:20px;margin-bottom:16px;box-shadow:0 2px 12px rgba(0,0,0,.08);border:2px dashed var(--orange)}
.setup-title{font-size:17px;font-weight:700;color:var(--orange);margin-bottom:12px}
.setup-steps{font-size:14px;color:var(--gray);line-height:2}
.setup-input{width:100%;padding:14px;border:2px solid #e0e0e0;border-radius:12px;font-size:15px;margin:12px 0}
.setup-input:focus{outline:none;border-color:var(--blue)}
.setup-btns{display:flex;gap:10px}
.setup-btn{flex:1;padding:14px;border:none;border-radius:12px;font-size:15px;font-weight:600;cursor:pointer}
.setup-btn.primary{background:var(--green);color:#fff}
.setup-btn.secondary{background:var(--blue);color:#fff}
.setup-status{margin-top:12px;padding:12px;border-radius:10px;font-size:14px}
.setup-status.success{background:#e8f5e9;color:#2e7d32}
.setup-status.error{background:#ffebee;color:#c62828}

.backup-box{background:linear-gradient(135deg,#fff3e0,#ffe0b2);border:2px solid var(--orange);border-radius:16px;padding:16px;margin-top:16px}
.backup-title{font-size:15px;font-weight:700;color:var(--orange);margin-bottom:6px}
.backup-text{font-size:14px;color:#795548}

.modal{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.5);z-index:200;justify-content:center;align-items:flex-end}
.modal.active{display:flex}
.modal-content{background:#fff;width:100%;max-width:500px;border-radius:24px 24px 0 0;padding:24px;padding-bottom:40px;max-height:90vh;overflow-y:auto}
.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
.modal-title{font-size:20px;font-weight:700}
.modal-close{background:none;border:none;font-size:28px;color:var(--light);cursor:pointer;padding:4px}
.form-group{margin-bottom:16px}
.form-label{display:block;font-size:14px;font-weight:500;margin-bottom:8px;color:var(--gray)}
.form-input,.form-select{width:100%;padding:14px;border:2px solid #e0e0e0;border-radius:12px;font-size:16px;background:#fff}
.form-input:focus,.form-select:focus{outline:none;border-color:var(--blue)}
.form-submit{width:100%;padding:16px;background:var(--blue);color:#fff;border:none;border-radius:12px;font-size:17px;font-weight:700;cursor:pointer;margin-top:8px}
.form-submit:disabled{background:#ccc}

.toast{position:fixed;bottom:100px;left:50%;transform:translateX(-50%);background:#333;color:#fff;padding:14px 24px;border-radius:25px;font-size:15px;z-index:300;opacity:0;transition:opacity .3s;pointer-events:none}
.toast.show{opacity:1}
.toast.success{background:#4caf50}
.toast.error{background:#f44336}

@media(max-width:400px){.budget-grid{grid-template-columns:repeat(2,1fr)}.budget-card.total{grid-column:span 2}}
</style>
</head>
<body>
<div class="app">
  <header class="header">
    <div class="header-icon">ğŸ¦Š</div>
    <div>
      <div class="header-title">åŒ—æµ·é“è‡ªé§•ä¹‹æ—…</div>
      <div class="header-sub">2026/1/28-2/4 ï½œ 4äºº</div>
    </div>
    <button class="header-sync" id="header-sync" onclick="syncData()" title="åŒæ­¥è³‡æ–™">ğŸ”„</button>
  </header>

  <div class="content">
    <div class="page active" id="page-itinerary">
      <div class="day-selector" id="day-selector"></div>
      <div id="day-content"></div>
      <div class="backup-box">
        <div class="backup-title">âš ï¸ å‚™æ¡ˆè¨ˆç•«</div>
        <div class="backup-text">è‹¥ç¬¬1å¤©ç­æ©Ÿå•é¡Œï¼Œå¯å–æ¶ˆå¯Œè‰¯é‡ä½å®¿ï¼Œç¬¬2å¤©å¾æ©Ÿå ´ç›´æ¥åˆ°æ—­å·ã€‚</div>
      </div>
    </div>

    <div class="page" id="page-hotels"></div>
    <div class="page" id="page-spots"></div>
    <div class="page" id="page-transport"></div>

    <div class="page" id="page-phrases">
      <div class="phrase-tabs" id="phrase-tabs"></div>
      <div id="phrases-list"></div>
    </div>

    <div class="page" id="page-budget">
      <div id="setup-section"></div>
      <div class="budget-grid" id="budget-grid"></div>
      <div class="expense-header">
        <div class="expense-title">ğŸ“ æ¶ˆè²»è¨˜éŒ„</div>
        <button class="expense-add-btn" onclick="openModal()">ï¼‹ æ–°å¢</button>
      </div>
      <div class="expense-status" id="conn-status"><span>â³</span> æœªé€£ç·š</div>
      <div class="expense-cats" id="expense-cats"></div>
      <div class="expense-list" id="expense-list"><div class="expense-empty">è«‹å…ˆè¨­å®š Google Sheets é€£ç·š</div></div>
    </div>

    <div class="page" id="page-info"></div>
  </div>

  <nav class="nav">
    <a class="nav-item active" data-page="itinerary"><span>ğŸ“…</span><small>è¡Œç¨‹</small></a>
    <a class="nav-item" data-page="hotels"><span>ğŸ¨</span><small>ä½å®¿</small></a>
    <a class="nav-item" data-page="spots"><span>ğŸ“</span><small>æ™¯é»</small></a>
    <a class="nav-item" data-page="transport"><span>ğŸš—</span><small>äº¤é€š</small></a>
    <a class="nav-item" data-page="phrases"><span>ğŸ’¬</span><small>æœƒè©±</small></a>
    <a class="nav-item" data-page="budget"><span>ğŸ’°</span><small>è¨˜å¸³</small></a>
    <a class="nav-item" data-page="info"><span>â„¹ï¸</span><small>è³‡è¨Š</small></a>
  </nav>
</div>

<div class="modal" id="modal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title">ğŸ’° æ–°å¢æ¶ˆè²»</div>
      <button class="modal-close" onclick="closeModal()">Ã—</button>
    </div>
    <form onsubmit="addExpense(event)">
      <div class="form-group"><label class="form-label">æ—¥æœŸ</label><input type="date" class="form-input" id="f-date" required></div>
      <div class="form-group"><label class="form-label">åˆ†é¡</label><select class="form-select" id="f-cat"><option value="flight">âœˆï¸ æ©Ÿç¥¨</option><option value="hotel">ğŸ¨ ä½å®¿</option><option value="car">ğŸš— ç§Ÿè»Š/æ²¹è²»</option><option value="food">ğŸ½ï¸ é¤é£²</option><option value="ticket">ğŸ« é–€ç¥¨</option><option value="shopping">ğŸ›ï¸ è³¼ç‰©</option><option value="other">ğŸ“¦ å…¶ä»–</option></select></div>
      <div class="form-group"><label class="form-label">èªªæ˜</label><input type="text" class="form-input" id="f-desc" placeholder="ä¾‹ï¼šæ—­å±±å‹•ç‰©åœ’é–€ç¥¨" required></div>
      <div class="form-group"><label class="form-label">å¹£åˆ¥</label><select class="form-select" id="f-cur"><option value="TWD">NT$ æ–°å°å¹£</option><option value="JPY">Â¥ æ—¥åœ“</option></select></div>
      <div class="form-group"><label class="form-label">é‡‘é¡</label><input type="number" class="form-input" id="f-amt" placeholder="0" required></div>
      <button type="submit" class="form-submit" id="submit-btn">æ–°å¢æ¶ˆè²»</button>
    </form>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
const STORAGE_KEY = 'hokkaido2026_api';
let API_URL = localStorage.getItem(STORAGE_KEY) || '';
let expenses = [];
let isOnline = false;
let currentDay = 1;
let currentPhraseFilter = 'all';
let currentExpenseFilter = 'all';

const itinerary = [
  {day:1,date:'1/28(ä¸‰)',title:'æŠµé”ãƒ»å¯Œè‰¯é‡',km:'123km',items:[
    {time:'06:20',title:'âœˆï¸ å°åŒ—å‡ºç™¼',desc:'è™èˆª IT234'},
    {time:'10:55',title:'ğŸ›¬ æŠµé”æ–°åƒæ­²'},
    {time:'11:30',title:'ğŸœ æ©Ÿå ´åˆé¤',type:'meal'},
    {time:'12:30',title:'ğŸš— å–è»Šå‡ºç™¼',desc:'åŒ—æµ·é“å¥³å©¿ï½œRAV4'},
    {time:'15:40',title:'ğŸ§š ç²¾éˆéœ²å°',desc:'æ£®æ—å¤¢å¹»å°æœ¨å±‹',nav:'ç²¾éˆéœ²å° å¯Œè‰¯é‡'},
    {time:'17:30',title:'ğŸ¨ å¯Œè‰¯é‡æ‹‰æ¼æ‘',desc:'æº«æ³‰ã€å«æ—©æ™šé¤',type:'hotel'}
  ]},
  {day:2,date:'1/29(å››)',title:'ç¾ç‘›ãƒ»æ—­å±±å‹•ç‰©åœ’',km:'50km',items:[
    {time:'07:40',title:'ğŸ³ é£¯åº—æ—©é¤',type:'meal'},
    {time:'09:30',title:'ğŸŒ² ç¾ç‘›åæ¨¹å·¡ç¦®',desc:'è–èª•æ¨¹ã€Kenèˆ‡Maryä¹‹æ¨¹',nav:'ç¾ç‘› è–èª•æ¨¹'},
    {time:'11:00',title:'ğŸ§ æ—­å±±å‹•ç‰©åœ’',desc:'ä¼éµæ•£æ­¥ 11:00/14:30',nav:'æ—­å±±å‹•ç‰©åœ’'},
    {time:'16:00',title:'ğŸ– æˆå‰æ€æ±—çƒ¤è‚‰',type:'meal'},
    {time:'æ™šä¸Š',title:'ğŸ›ï¸ å¹³å’Œé€šè²·ç‰©å…¬åœ’',desc:'DCMè²·é‹é‡˜'},
    {time:'ä½å®¿',title:'ğŸ¨ æ—­å·å®¢æ¨‚æ£®',desc:'æº«æ³‰',type:'hotel'}
  ]},
  {day:3,date:'1/30(äº”)',title:'å±¤é›²å³½å†°ç€‘ç¥­',km:'65km',items:[
    {time:'07:40',title:'ğŸ³ é£¯åº—æ—©é¤',type:'meal'},
    {time:'09:00',title:'ğŸš— å‡ºç™¼å±¤é›²å³½',desc:'ç´„1.5å°æ™‚'},
    {time:'14:00',title:'ğŸ¨ å±¤é›²å³½æœé™½äº­',desc:'æº«æ³‰ã€å«æ—©æ™šé¤',type:'hotel'},
    {time:'17:00',title:'ğŸ§Š å±¤é›²å³½å†°ç€‘ç¥­',desc:'å£¯è§€å†°é›•ã€å¤œé–“é»ç‡ˆ',nav:'å±¤é›²å³½å†°ç€‘ç¥­'},
    {time:'20:00',title:'ğŸ† ç…™ç«è¡¨æ¼”'}
  ]},
  {day:4,date:'1/31(å…­)',title:'åŒ—ç‹ç‰§å ´ãƒ»é˜¿å¯’æ¹–',km:'156km',items:[
    {time:'07:40',title:'ğŸ³ é£¯åº—æ—©é¤',type:'meal'},
    {time:'10:40',title:'ğŸ¦Š åŒ—ç‹ç‰§å ´',desc:'è¿‘è·é›¢çœ‹ç‹ç‹¸ï¼Â¥500',nav:'åŒ—ãã¤ã­ç‰§å ´'},
    {time:'14:30',title:'ğŸ¨ æ–°é˜¿å¯’é£¯åº—',desc:'æº«æ³‰ã€å«æ—©æ™šé¤',type:'hotel'},
    {time:'ä¸‹åˆ',title:'ğŸ”ï¸ é˜¿å¯’æ¹–æ•£ç­–',desc:'æ¹–ç•”ã€æ„›åŠªæ‘è½',nav:'é˜¿å¯’æ¹–'}
  ]},
  {day:5,date:'2/1(æ—¥)',title:'é˜¿å¯’æ¹–ãƒ»åå‹å·',km:'120km',items:[
    {time:'08:30',title:'ğŸ£ é˜¿å¯’æ¹–å†°ä¸Šé‡£é­š',desc:'å†¬å­£é™å®šï¼',nav:'é˜¿å¯’æ¹–'},
    {time:'12:00',title:'ğŸ· å¸¶å»£è±¬è‚‰è“‹é£¯',type:'meal'},
    {time:'14:00',title:'ğŸ° å…­èŠ±äº­',desc:'è²·ä¼´æ‰‹ç¦®',nav:'å…­èŠ±äº­ å¸¯åºƒæœ¬åº—'},
    {time:'16:00',title:'ğŸ¨ åå‹å·Tetra',desc:'æµ´å ´ã€å«æ—©é¤',type:'hotel'},
    {time:'19:00',title:'âœ¨ åå‹å·å½©ç‡ˆç¥­'}
  ]},
  {day:6,date:'2/2(ä¸€)',title:'å‰å¾€æœ­å¹Œ',km:'205km',items:[
    {time:'07:20',title:'ğŸ³ é£¯åº—æ—©é¤',type:'meal'},
    {time:'08:40',title:'ğŸš— å‡ºç™¼æœ­å¹Œ',desc:'ç´„3å°æ™‚'},
    {time:'15:00',title:'ğŸ¨ æœ­å¹ŒVessel Inn',desc:'å¾…è¨‚',type:'hotel'},
    {time:'ä¸‹åˆ',title:'â„ï¸ æœ­å¹Œé›ªç¥­',desc:'å¤§é€šå…¬åœ’',nav:'å¤§é€šå…¬åœ’ æœ­å¹Œ'},
    {time:'18:00',title:'ğŸ¦€ è–„é‡èƒèŸ¹åƒåˆ°é£½',type:'meal'}
  ]},
  {day:7,date:'2/3(äºŒ)',title:'æœ­å¹Œãƒ»åƒæ­²',km:'54km',items:[
    {time:'09:30',title:'ğŸ›ï¸ æœ­å¹Œæˆ–Tsudome',desc:'ç©é›ªè¨­æ–½'},
    {time:'16:00',title:'â›½ åŠ æ²¹'},
    {time:'17:30',title:'ğŸ¨ åƒæ­²æ‚ éŠé¤¨',desc:'è¿‘æ©Ÿå ´',type:'hotel'}
  ]},
  {day:8,date:'2/4(ä¸‰)',title:'è¿”å›å°ç£',km:'7km',items:[
    {time:'07:40',title:'ğŸ§³ é€€æˆ¿é‚„è»Š'},
    {time:'08:40',title:'ğŸœ æ©Ÿå ´æ—©é¤',type:'meal'},
    {time:'11:55',title:'âœˆï¸ èµ·é£›è¿”å°',desc:'è™èˆª IT235'},
    {time:'15:35',title:'ğŸ›¬ æŠµé”æ¡ƒåœ’',desc:'ãŠã¤ã‹ã‚Œã•ã¾ï¼'}
  ]}
];

// ä½¿ç”¨ Unsplash å…è²»åœ–ç‰‡ï¼ˆé€™äº›éƒ½æ˜¯ç©©å®šå¯ç”¨çš„ï¼‰
const spots = [
  {
    region:'å¯Œè‰¯é‡',
    name:'ğŸ§š ç²¾éˆéœ²å°',
    jp:'ãƒ‹ãƒ³ã‚°ãƒ«ãƒ†ãƒ©ã‚¹',
    img:'https://images.unsplash.com/photo-1548116137-c9ac24e446c9?w=800&h=400&fit=crop',
    desc:'æ£®æ—ä¸­ç´„15é–“å¤¢å¹»å°æœ¨å±‹ï¼Œç”±è„šæœ¬å®¶å€‰æœ¬è°ä½œå“å‘½åã€‚ã€Œãƒ‹ãƒ³ã‚°ãƒ«ã€åœ¨æ„›åŠªèªä¸­æ„æŒ‡ã€Œæ£®æ—å°ç²¾éˆã€ã€‚æ¯é–“å°å±‹éƒ½æ˜¯ç¨ç«‹å·¥è—å“åº—ï¼Œè²©å”®æ‰‹å·¥è Ÿç‡­ã€éŠ€é£¾ã€æœ¨é›•ç­‰ã€‚å†¬å­£å¤œé–“é»ç‡ˆå¾Œå¦‚ç«¥è©±ä¸–ç•Œã€‚',
    address:'åŒ—æµ·é“å¯Œè‰¯é‡å¸‚ä¸­å¾¡æ–™',
    hours:'12:00-20:45',
    price:'å…è²»å…¥å ´',
    tips:'å»ºè­°ä¸‹åˆ4é»å¾Œä¾†ï¼Œå¯åŒæ™‚æ‹åˆ°æ—¥æ™¯å’Œå¤œé–“é»ç‡ˆã€‚å¤©å†·è¨˜å¾—ä¿æš–ï¼',
    nav:'ç²¾éˆéœ²å° å¯Œè‰¯é‡'
  },
  {
    region:'ç¾ç‘›',
    name:'ğŸŒ² ç¾ç‘›åæ¨¹å·¡ç¦®',
    jp:'ç¾ç‘›ã®ä¸˜',
    img:'https://images.unsplash.com/photo-1491002052546-bf38f186af56?w=800&h=400&fit=crop',
    desc:'ç¾ç‘›ä¸˜é™µåœ°å½¢ä¸Šçš„ç¨ç«‹æ¨¹æœ¨ï¼Œå› å»£å‘Šè€Œèåã€‚ã€Œè–èª•æ¨¹ã€æ˜¯ç¨ç«‹æ–¼é›ªåŸä¸Šçš„é›²æ‰ï¼Œã€ŒKenèˆ‡Maryä¹‹æ¨¹ã€å› æ—¥ç”¢æ±½è»Šå»£å‘Šå¾—åï¼Œã€Œä¸ƒæ˜Ÿä¹‹æ¨¹ã€å‰‡æ˜¯ä¸ƒæ˜Ÿé¦™è¸åŒ…è£çš„å–æ™¯åœ°ã€‚',
    address:'åŒ—æµ·é“ä¸Šå·éƒ¡ç¾ç‘›ç”º',
    hours:'å…¨å¤©é–‹æ”¾',
    price:'å…è²»',
    tips:'æ¨¹æœ¨éƒ½åœ¨è¾²åœ°ç§æœ‰åœ°é™„è¿‘ï¼Œè«‹å‹¿é€²å…¥è¾²åœ°æ‹ç…§ã€‚å†¬å­£é“è·¯æ¿•æ»‘æ³¨æ„å®‰å…¨ã€‚',
    nav:'ç¾ç‘› è–èª•æ¨¹'
  },
  {
    region:'æ—­å·',
    name:'ğŸ§ æ—­å±±å‹•ç‰©åœ’',
    jp:'ã‚ã•ã²ã‚„ã¾ã©ã†ã¶ã¤ãˆã‚“',
    img:'https://images.unsplash.com/photo-1559253664-ca249d4608c6?w=800&h=400&fit=crop',
    desc:'æ—¥æœ¬æœ€åŒ—ç«¯çš„å‹•ç‰©åœ’ï¼Œä»¥ã€Œè¡Œå‹•å±•ç¤ºã€èåã€‚å†¬å­£é™å®šçš„ã€Œä¼éµæ•£æ­¥ã€æ˜¯æœ€å¤§äº®é»ï¼Œèƒ–å˜Ÿå˜Ÿçš„ä¼éµæ–æ–æ“ºæ“ºèµ°åœ¨é›ªåœ°ä¸Šè¶…ç™‚ç™’ï¼é‚„å¯çœ‹åˆ°åŒ—æ¥µç†Šæ¸¸æ³³ã€æµ·è±¹ç©¿è¶Šæ°´é“ã€‚',
    address:'åŒ—æµ·é“æ—­å·å¸‚æ±æ—­å·ç”ºå€‰æ²¼',
    hours:'å†¬å­£ 10:30-15:30',
    price:'æˆäºº Â¥1,000',
    tips:'ä¼éµæ•£æ­¥ï¼š11:00ã€14:30ï¼ˆæå‰30åˆ†é˜å¡ä½ï¼‰ã€‚ç¦æ­¢ä½¿ç”¨é–ƒå…‰ç‡ˆï¼',
    nav:'æ—­å±±å‹•ç‰©åœ’'
  },
  {
    region:'å±¤é›²å³½',
    name:'ğŸ§Š å±¤é›²å³½å†°ç€‘ç¥­',
    jp:'å±¤é›²å³¡æ¸©æ³‰æ°·ç€‘ã¾ã¤ã‚Š',
    img:'https://images.unsplash.com/photo-1516912481808-3406841bd33c?w=800&h=400&fit=crop',
    desc:'åŒ—æµ·é“ä¸‰å¤§å†¬ç¥­ä¹‹ä¸€ï¼åˆ©ç”¨çŸ³ç‹©å·æ²³åºŠç´„1è¬å¹³æ–¹å…¬å°ºçš„å ´åœ°ï¼Œå±•ç¤ºç´„30åº§å¤§å°å†°é›•ã€‚ç™½å¤©å†°é›•å‘ˆç¾ç¥ç§˜è—å…‰ï¼Œå¤œæ™šä¸ƒå½©ç‡ˆå…‰ç…§å°„æ›´åŠ å¤¢å¹»ã€‚æ¯æ™š20:00ç…™ç«è¡¨æ¼”ï¼',
    address:'åŒ—æµ·é“ä¸Šå·éƒ¡ä¸Šå·ç”ºå±¤é›²å³½æº«æ³‰',
    hours:'17:00-21:30',
    price:'å…¥å ´ Â¥1,000',
    tips:'æœƒå ´åœ°é¢éå¸¸æ»‘ï¼å‹™å¿…ç©¿é˜²æ»‘é›ªé´ã€‚æ°£æº«å¯èƒ½-20Â°Cä»¥ä¸‹ï¼Œåšå¥½ä¿æš–ã€‚',
    nav:'å±¤é›²å³½å†°ç€‘ç¥­'
  },
  {
    region:'åŒ—è¦‹',
    name:'ğŸ¦Š åŒ—ç‹ç‰§å ´',
    jp:'åŒ—ãã¤ã­ç‰§å ´',
    img:'https://images.unsplash.com/photo-1474511320723-9a56873571b7?w=800&h=400&fit=crop',
    desc:'ç´„60éš»åŒ—æµ·é“ç‹ç‹¸åœ¨6è¬å¹³æ–¹å…¬å°ºçš„åœ’å€å…§è‡ªç”±æ”¾é¤Šã€‚èˆ‡å‹•ç‰©åœ’ä¸åŒï¼Œé€™è£¡çš„ç‹ç‹¸ä¸æ€•äººï¼Œæœƒä¸»å‹•é è¿‘éŠå®¢è…³é‚Šã€‚å†¬å­£æ¯›èŒ¸èŒ¸çš„ã€Œå†¬æ¯›ã€ç‹€æ…‹æœ€å¯æ„›ï¼',
    address:'åŒ—æµ·é“åŒ—è¦‹å¸‚ç•™è¾ºè˜‚ç”ºèŠ±ä¸˜52-1',
    hours:'å†¬å­£ 9:00-16:00',
    price:'æˆäºº Â¥500',
    tips:'ç¦æ­¢è§¸æ‘¸ç‹ç‹¸å’Œé¤µé£Ÿã€‚ç‹ç‹¸æœ‰é‡æ€§ï¼Œè«‹å‹¿è¹²ä¸‹æˆ–åšçªç„¶å‹•ä½œã€‚',
    nav:'åŒ—ãã¤ã­ç‰§å ´'
  },
  {
    region:'é˜¿å¯’æ¹–',
    name:'ğŸ£ é˜¿å¯’æ¹–å†°ä¸Šé‡£é­š',
    jp:'ã‚ã‹ã•ãé‡£ã‚Š',
    img:'https://images.unsplash.com/photo-1478719059408-592965723cbc?w=800&h=400&fit=crop',
    desc:'å†¬å­£é™å®šé«”é©—ï¼åœ¨çµå†°çš„é˜¿å¯’æ¹–é¢ä¸Šé‘¿æ´é‡£è¥¿å¤ªå…¬é­šï¼ˆã‚ã‹ã•ãï¼‰ã€‚ç§Ÿå€Ÿé‡£å…·ã€å¸³ç¯·ï¼Œå·¥ä½œäººå“¡æœƒæ•™å­¸ã€‚é‡£åˆ°çš„é­šå¯ä»¥ç¾å ´æ²¹ç‚¸å“åšï¼Œè¶…ç¾å‘³ï¼',
    address:'åŒ—æµ·é“é‡§è·¯å¸‚é˜¿å¯’ç”ºé˜¿å¯’æ¹–æº«æ³‰',
    hours:'ç´„ 8:00-16:00',
    price:'ç´„ Â¥1,500-2,000',
    tips:'æ¹–ä¸Šå¸³ç¯·å…§æœ‰æš–çˆä½†é‚„æ˜¯å¾ˆå†·ï¼Œå»ºè­°ç©¿æœ€ä¿æš–çš„è¡£ç‰©ã€‚',
    nav:'é˜¿å¯’æ¹–'
  },
  {
    region:'å¸¶å»£',
    name:'ğŸ° å…­èŠ±äº­æœ¬åº—',
    jp:'å…­èŠ±äº­',
    img:'https://images.unsplash.com/photo-1551024506-0bccd828d307?w=800&h=400&fit=crop',
    desc:'åŒ—æµ·é“æœ€çŸ¥åçš„ç”œé»å“ç‰Œï¼æœ¬åº—é™å®šçš„ã€Œã‚µã‚¯ã‚µã‚¯ãƒ‘ã‚¤ã€ï¼ˆé…¥è„†æ´¾ï¼‰åªæœ‰é€™è£¡åƒå¾—åˆ°ã€‚å¿…è²·ä¼´æ‰‹ç¦®ï¼šå¥¶æ²¹è‘¡è„å¤¾å¿ƒé¤…ä¹¾ã€‚2æ¨“æœ‰å’–å•¡å»³å¯ä»¥æ‚ é–’å“åšã€‚',
    address:'åŒ—æµ·é“å¸¶å»£å¸‚è¥¿2æ¡å—9ä¸ç›®6ç•ªåœ°',
    hours:'9:00-18:00',
    price:'ä¼´æ‰‹ç¦®ç´„ Â¥500-2,000',
    tips:'æœ¬åº—é™å®šçš„é…¥è„†æ´¾è³å‘³æœŸé™åªæœ‰3å°æ™‚ï¼è¨˜å¾—ç¾å ´åƒã€‚',
    nav:'å…­èŠ±äº­ å¸¯åºƒæœ¬åº—'
  },
  {
    region:'æœ­å¹Œ',
    name:'â„ï¸ æœ­å¹Œé›ªç¥­',
    jp:'ã•ã£ã½ã‚é›ªã¾ã¤ã‚Š',
    img:'https://images.unsplash.com/photo-1542931287-023b922fa89b?w=800&h=400&fit=crop',
    desc:'æ—¥æœ¬æœ€å¤§è¦æ¨¡çš„é›ªç¥­ï¼å¤§é€šå…¬åœ’æœƒå ´å±•ç¤ºå·¨å‹é›ªé›•ï¼Œæœ‰äº›é«˜é”15å…¬å°ºã€‚å¤œé–“é»ç‡ˆå¾Œæ›´åŠ å£¯è§€ã€‚Tsudomeæœƒå ´å¯ä»¥ç©é›ªä¸Šæ»‘æ¢¯ç­‰è¨­æ–½ï¼Œé©åˆè¦ªå­åŒéŠã€‚',
    address:'åŒ—æµ·é“æœ­å¹Œå¸‚ä¸­å¤®å€å¤§é€šå…¬åœ’',
    hours:'å…¨å¤©é–‹æ”¾',
    price:'å…è²»å…¥å ´',
    tips:'2026å¹´é è¨ˆ2/4-2/11èˆ‰è¾¦ï¼Œæˆ‘å€‘2/2æŠµé”å¯å…ˆçœ‹æº–å‚™ä¸­çš„é›ªé›•ï¼',
    nav:'å¤§é€šå…¬åœ’ æœ­å¹Œ'
  }
];

const hotels = [
  {date:'1/28',nights:'1æ™š',name:'å¯Œè‰¯é‡æ‹‰æ¼æ‘é…’åº—',location:'Furano la terre',room:'4äººæ¦»æ¦»ç±³',booking:'EZè¨‚æˆ¿',tags:['â™¨ï¸æº«æ³‰','ğŸ³æ—©é¤','ğŸ½ï¸æ™šé¤'],price:7000},
  {date:'1/29',nights:'1æ™š',name:'æ—­å·å®¢æ¨‚æ£®é…’åº—',location:'æ—­å·Grand Hotel',room:'2é–“æˆ¿',booking:'Agoda',extra:'æ—©é¤Â¥1,760Ã—2+åœè»ŠÂ¥800',tags:['â™¨ï¸æº«æ³‰','ğŸ…¿ï¸ä»˜è²»åœè»Š'],price:4643},
  {date:'1/30',nights:'1æ™š',name:'å±¤é›²å³½æœé™½äº­',location:'å±¤é›²å³½æº«æ³‰',room:'4äººæˆ¿5åºŠ',booking:'æš«EZ',tags:['â™¨ï¸æº«æ³‰','ğŸ³æ—©é¤','ğŸ½ï¸æ™šé¤'],price:9591},
  {date:'1/31',nights:'1æ™š',name:'æ–°é˜¿å¯’é£¯åº—',location:'é˜¿å¯’æ¹–æº«æ³‰',room:'4äººæˆ¿',booking:'EZè¨‚æˆ¿',tags:['â™¨ï¸æº«æ³‰','ğŸ³æ—©é¤','ğŸ½ï¸æ™šé¤'],price:10545},
  {date:'2/1',nights:'1æ™š',name:'åå‹å·Tetra Resort',location:'Hotel Tetra',room:'4äººæˆ¿',booking:'Agoda',tags:['ğŸ›æµ´å ´','ğŸ³æ—©é¤'],price:4643},
  {date:'2/2',nights:'1æ™š',name:'æœ­å¹ŒVessel Inn',location:'æœ­å¹Œå¸‚å€',room:'å¾…ç¢ºèª',booking:'Klook',tags:['â³å¾…è¨‚'],warn:true,price:5400},
  {date:'2/3',nights:'1æ™š',name:'åƒæ­²æ‚ éŠé¤¨',location:'åƒæ­²è¿‘æ©Ÿå ´',room:'4äººä¸Šä¸‹åºŠ',booking:'EZè¨‚æˆ¿',tags:['âŒç„¡æ—©é¤'],no:true,price:4033}
];

const phrases = [
  {cat:'driving',jp:'ã‚¬ã‚½ãƒªãƒ³ã‚¹ã‚¿ãƒ³ãƒ‰ã¯ã©ã“ã§ã™ã‹ï¼Ÿ',ro:'Gasorin sutando wa doko desu ka?',zh:'åŠ æ²¹ç«™åœ¨å“ªè£¡ï¼Ÿ'},
  {cat:'driving',jp:'ãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼æº€ã‚¿ãƒ³ã§ãŠé¡˜ã„ã—ã¾ã™',ro:'RegyurÄ mantan de onegai shimasu',zh:'è«‹åŠ æ»¿ä¸€èˆ¬æ±½æ²¹'},
  {cat:'driving',jp:'é§è»Šå ´ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ',ro:'ChÅ«shajÅ wa arimasu ka?',zh:'æœ‰åœè»Šå ´å—ï¼Ÿ'},
  {cat:'driving',jp:'é“ã«è¿·ã„ã¾ã—ãŸ',ro:'Michi ni mayoimashita',zh:'æˆ‘è¿·è·¯äº†'},
  {cat:'restaurant',jp:'å››äººã§ã™',ro:'Yonin desu',zh:'å››å€‹äºº'},
  {cat:'restaurant',jp:'ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ãŠé¡˜ã„ã—ã¾ã™',ro:'MenyÅ« o onegai shimasu',zh:'è«‹çµ¦æˆ‘èœå–®'},
  {cat:'restaurant',jp:'ãŠã™ã™ã‚ã¯ä½•ã§ã™ã‹ï¼Ÿ',ro:'Osusume wa nan desu ka?',zh:'æ¨è–¦ä»€éº¼ï¼Ÿ'},
  {cat:'restaurant',jp:'ã“ã‚Œã‚’ãã ã•ã„',ro:'Kore o kudasai',zh:'è«‹çµ¦æˆ‘é€™å€‹'},
  {cat:'restaurant',jp:'ãŠä¼šè¨ˆãŠé¡˜ã„ã—ã¾ã™',ro:'Okaikei onegai shimasu',zh:'è«‹çµå¸³'},
  {cat:'restaurant',jp:'ã‚«ãƒ¼ãƒ‰ã§æ‰•ãˆã¾ã™ã‹ï¼Ÿ',ro:'KÄdo de haraemasu ka?',zh:'å¯ä»¥åˆ·å¡å—ï¼Ÿ'},
  {cat:'onsen',jp:'æ¸©æ³‰ã¯ã©ã“ã§ã™ã‹ï¼Ÿ',ro:'Onsen wa doko desu ka?',zh:'æº«æ³‰åœ¨å“ªè£¡ï¼Ÿ'},
  {cat:'onsen',jp:'ã‚¿ã‚ªãƒ«ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ',ro:'Taoru wa arimasu ka?',zh:'æœ‰æ¯›å·¾å—ï¼Ÿ'},
  {cat:'onsen',jp:'éœ²å¤©é¢¨å‘‚ã¯ã©ã“ã§ã™ã‹ï¼Ÿ',ro:'Rotenburo wa doko desu ka?',zh:'éœ²å¤©é¢¨å‘‚åœ¨å“ªï¼Ÿ'},
  {cat:'shopping',jp:'ã“ã‚Œã¯ã„ãã‚‰ã§ã™ã‹ï¼Ÿ',ro:'Kore wa ikura desu ka?',zh:'é€™å€‹å¤šå°‘éŒ¢ï¼Ÿ'},
  {cat:'shopping',jp:'å…ç¨ã§ãã¾ã™ã‹ï¼Ÿ',ro:'Menzei dekimasu ka?',zh:'å¯ä»¥å…ç¨…å—ï¼Ÿ'},
  {cat:'shopping',jp:'è¢‹ã‚’ãŠé¡˜ã„ã—ã¾ã™',ro:'Fukuro o onegai shimasu',zh:'è«‹çµ¦æˆ‘è¢‹å­'},
  {cat:'emergency',jp:'åŠ©ã‘ã¦ãã ã•ã„',ro:'Tasukete kudasai',zh:'è«‹å¹«å¹«æˆ‘'},
  {cat:'emergency',jp:'ç—…é™¢ã¯ã©ã“ã§ã™ã‹ï¼Ÿ',ro:'ByÅin wa doko desu ka?',zh:'é†«é™¢åœ¨å“ªè£¡ï¼Ÿ'},
  {cat:'emergency',jp:'æ°—åˆ†ãŒæ‚ªã„ã§ã™',ro:'Kibun ga warui desu',zh:'æˆ‘ä¸èˆ’æœ'}
];

function init() {
  setupNavigation();
  renderDaySelector();
  renderDay(1);
  renderHotels();
  renderSpots();
  renderTransport();
  renderPhraseTabs();
  renderPhrases();
  renderBudgetPage();
  renderInfo();
  if (API_URL) { document.getElementById('setup-section').innerHTML = ''; syncData(); } else { renderSetup(); }
}

function setupNavigation() {
  document.querySelectorAll('.nav-item').forEach(item => {
    item.addEventListener('click', () => {
      const page = item.dataset.page;
      document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      item.classList.add('active');
      document.getElementById('page-' + page).classList.add('active');
    });
  });
}

function renderDaySelector() {
  document.getElementById('day-selector').innerHTML = itinerary.map(d => `<div class="day-btn ${d.day === 1 ? 'active' : ''}" onclick="selectDay(${d.day})"><div class="day-btn-num">${d.day}</div><div class="day-btn-date">${d.date.split('(')[0]}</div></div>`).join('');
}

function selectDay(day) {
  currentDay = day;
  document.querySelectorAll('.day-btn').forEach((btn, i) => btn.classList.toggle('active', i + 1 === day));
  renderDay(day);
}

function renderDay(day) {
  const d = itinerary.find(i => i.day === day);
  document.getElementById('day-content').innerHTML = `
    <div class="card"><div class="card-header"><div class="card-title">Day ${d.day} ï½œ ${d.title}</div><div class="card-sub">${d.date} ãƒ» ${d.km}</div></div><div class="card-body"><div class="timeline">
      ${d.items.map(item => `<div class="tl-item ${item.type || ''}"><div class="tl-dot"></div><div class="tl-time">${item.time}</div><div class="tl-title">${item.title}</div>${item.desc ? `<div class="tl-desc">${item.desc}</div>` : ''}${item.nav ? `<a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.nav)}" target="_blank" class="tl-link">ğŸ“ å°èˆªå‰å¾€</a>` : ''}</div>`).join('')}
    </div></div></div>`;
}

function renderHotels() {
  document.getElementById('page-hotels').innerHTML = hotels.map(h => `
    <div class="hotel-card"><div class="hotel-header" ${h.warn ? 'style="background:linear-gradient(135deg,#ff6d00,#f57c00)"' : ''}><div class="hotel-date">ğŸ“… ${h.date} ${h.nights}</div><div class="hotel-name">${h.name}</div></div><div class="hotel-body"><div class="hotel-info">ğŸ“ ${h.location}<br>ğŸ›ï¸ ${h.room}<br>ğŸ“± ${h.booking}${h.extra ? `<br>ğŸ’´ ${h.extra}` : ''}</div><div class="hotel-tags">${h.tags.map(t => `<span class="hotel-tag ${h.warn ? 'warn' : ''} ${h.no ? 'no' : ''}">${t}</span>`).join('')}</div><div class="hotel-price"><span class="hotel-price-label">${h.warn ? 'é ä¼°æˆ¿åƒ¹' : 'æˆ¿åƒ¹'}</span><span class="hotel-price-value">NT$${h.price.toLocaleString()}</span></div></div></div>
  `).join('');
}

function renderSpots() {
  document.getElementById('page-spots').innerHTML = spots.map(s => `
    <div class="spot-card">
      <img class="spot-img" src="${s.img}" alt="${s.name}" loading="lazy">
      <div class="spot-body">
        <span class="spot-region">${s.region}</span>
        <div class="spot-name">${s.name}</div>
        <div class="spot-jp">${s.jp}</div>
        <div class="spot-desc">${s.desc}</div>
        <div class="spot-info-grid">
          <div class="spot-info-item"><div class="spot-info-label">ç‡Ÿæ¥­æ™‚é–“</div><div class="spot-info-value">${s.hours}</div></div>
          <div class="spot-info-item"><div class="spot-info-label">è²»ç”¨</div><div class="spot-info-value">${s.price}</div></div>
          <div class="spot-info-item" style="grid-column:span 2"><div class="spot-info-label">åœ°å€</div><div class="spot-info-value">${s.address}</div></div>
        </div>
        <div class="spot-tips"><div class="spot-tips-title">ğŸ’¡ å°æé†’</div><div class="spot-tips-content">${s.tips}</div></div>
        <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(s.nav)}" target="_blank" class="spot-nav-btn">ğŸ“ é–‹å•Ÿ Google Maps å°èˆª</a>
      </div>
    </div>
  `).join('');
}

function renderTransport() {
  document.getElementById('page-transport').innerHTML = `
    <div class="trans-box"><div class="trans-title">âœˆï¸ èˆªç­è³‡è¨Š</div><div class="trans-row"><span class="trans-label">å»ç¨‹</span><span class="trans-value">IT234 1/28</span></div><div class="trans-row"><span class="trans-label">æ™‚é–“</span><span class="trans-value">06:20â†’10:55</span></div><div class="trans-row"><span class="trans-label">å›ç¨‹</span><span class="trans-value">IT235 2/4</span></div><div class="trans-row"><span class="trans-label">æ™‚é–“</span><span class="trans-value">11:55â†’15:35</span></div><div class="trans-row"><span class="trans-label">æ©Ÿç¥¨ç¸½åƒ¹</span><span class="trans-value red">NT$86,282</span></div></div>
    <div class="trans-box"><div class="trans-title">ğŸš— ç§Ÿè»Šè³‡è¨Š</div><div class="trans-row"><span class="trans-label">ç§Ÿè»Šå…¬å¸</span><span class="trans-value">åŒ—æµ·é“å¥³å©¿</span></div><div class="trans-row"><span class="trans-label">è»Šå‹</span><span class="trans-value">RAV4/Corolla Cross</span></div><div class="trans-row"><span class="trans-label">å–è»Š</span><span class="trans-value">1/28 12:30</span></div><div class="trans-row"><span class="trans-label">é‚„è»Š</span><span class="trans-value">2/4 08:00</span></div><div class="trans-row"><span class="trans-label">ç§Ÿè»Šè²»ç”¨</span><span class="trans-value red">Â¥89,600</span></div><div class="trans-row"><span class="trans-label">ETCè¨­å‚™</span><span class="trans-value">Â¥550</span></div></div>
    <div class="trans-box"><div class="trans-title">ğŸ—ºï¸ æ¯æ—¥è·¯ç·š</div><table class="route-table"><thead><tr><th>æ—¥</th><th>è·¯ç·š</th><th>km</th></tr></thead><tbody><tr><td>1</td><td>æ–°åƒæ­²â†’å¯Œè‰¯é‡</td><td>123</td></tr><tr><td>2</td><td>å¯Œè‰¯é‡â†’æ—­å·</td><td>50</td></tr><tr><td>3</td><td>æ—­å·â†’å±¤é›²å³½</td><td>65</td></tr><tr><td>4</td><td>å±¤é›²å³½â†’é˜¿å¯’æ¹–</td><td>156</td></tr><tr><td>5</td><td>é˜¿å¯’æ¹–â†’åå‹å·</td><td>120</td></tr><tr><td>6</td><td>åå‹å·â†’æœ­å¹Œ</td><td>205</td></tr><tr><td>7</td><td>æœ­å¹Œâ†’åƒæ­²</td><td>54</td></tr><tr><td>8</td><td>åƒæ­²â†’æ©Ÿå ´</td><td>7</td></tr></tbody><tfoot><tr><td colspan="2">ç¸½è¨ˆ</td><td>780km</td></tr></tfoot></table></div>`;
}

function renderPhraseTabs() {
  document.getElementById('phrase-tabs').innerHTML = [{id:'all',label:'å…¨éƒ¨'},{id:'driving',label:'ğŸš—è‡ªé§•'},{id:'restaurant',label:'ğŸ½ï¸é¤å»³'},{id:'onsen',label:'â™¨ï¸æº«æ³‰'},{id:'shopping',label:'ğŸ›ï¸è³¼ç‰©'},{id:'emergency',label:'ğŸ†˜ç·Šæ€¥'}].map(t => `<div class="phrase-tab ${t.id === 'all' ? 'active' : ''}" onclick="filterPhrases('${t.id}')">${t.label}</div>`).join('');
}

function filterPhrases(cat) {
  currentPhraseFilter = cat;
  document.querySelectorAll('.phrase-tab').forEach(t => t.classList.remove('active'));
  event.target.classList.add('active');
  renderPhrases();
}

function renderPhrases() {
  const filtered = currentPhraseFilter === 'all' ? phrases : phrases.filter(p => p.cat === currentPhraseFilter);
  document.getElementById('phrases-list').innerHTML = filtered.map(p => `<div class="phrase-card ${p.cat}" onclick="speak('${p.jp}')"><div class="phrase-jp">${p.jp}</div><div class="phrase-romaji">${p.ro}</div><div class="phrase-zh">${p.zh}</div><div class="phrase-play">ğŸ”Š é»æ“Šæ’­æ”¾ç™¼éŸ³</div></div>`).join('');
}

function speak(text) { if ('speechSynthesis' in window) { const u = new SpeechSynthesisUtterance(text); u.lang = 'ja-JP'; u.rate = 0.8; speechSynthesis.speak(u); showToast('ğŸ”Š æ’­æ”¾ä¸­...', ''); } }

function renderSetup() {
  document.getElementById('setup-section').innerHTML = `<div class="setup-card"><div class="setup-title">âš™ï¸ è¨­å®š Google Sheets</div><div class="setup-steps">1. å»ºç«‹ Google Sheet<br>2. æ“´å……åŠŸèƒ½ â†’ Apps Script<br>3. è²¼ä¸Šç¨‹å¼ç¢¼ä¸¦éƒ¨ç½²<br>4. å°‡ç¶²å€è²¼åˆ°ä¸‹æ–¹</div><input type="text" class="setup-input" id="api-url" placeholder="è²¼ä¸Š Apps Script ç¶²å€..."><div class="setup-btns"><button class="setup-btn primary" onclick="saveApiUrl()">ğŸ’¾ å„²å­˜</button><button class="setup-btn secondary" onclick="testConnection()">ğŸ”— æ¸¬è©¦</button></div><div class="setup-status" id="setup-status" style="display:none"></div></div>`;
}

function renderBudgetPage() {
  document.getElementById('budget-grid').innerHTML = `<div class="budget-card"><div class="budget-icon">âœˆï¸</div><div class="budget-label">æ©Ÿç¥¨</div><div class="budget-value" id="b-flight">NT$0</div></div><div class="budget-card"><div class="budget-icon">ğŸ¨</div><div class="budget-label">ä½å®¿</div><div class="budget-value" id="b-hotel">NT$0</div></div><div class="budget-card"><div class="budget-icon">ğŸš—</div><div class="budget-label">ç§Ÿè»Š</div><div class="budget-value" id="b-car">Â¥0</div></div><div class="budget-card"><div class="budget-icon">ğŸ½ï¸</div><div class="budget-label">é¤é£²</div><div class="budget-value" id="b-food">NT$0</div></div><div class="budget-card"><div class="budget-icon">ğŸ«</div><div class="budget-label">é–€ç¥¨</div><div class="budget-value" id="b-ticket">NT$0</div></div><div class="budget-card total"><div class="budget-icon">ğŸ’³</div><div class="budget-label">ç¸½è¨ˆ(å°å¹£)</div><div class="budget-value" id="b-total">NT$0</div></div>`;
  document.getElementById('expense-cats').innerHTML = [{id:'all',label:'å…¨éƒ¨',bg:'#e3f2fd',color:'#1976d2'},{id:'flight',label:'âœˆï¸',bg:'#e3f2fd',color:'#1976d2'},{id:'hotel',label:'ğŸ¨',bg:'#f3e5f5',color:'#7b1fa2'},{id:'car',label:'ğŸš—',bg:'#e8f5e9',color:'#2e7d32'},{id:'food',label:'ğŸ½ï¸',bg:'#fff3e0',color:'#ef6c00'},{id:'ticket',label:'ğŸ«',bg:'#fce4ec',color:'#c2185b'},{id:'shopping',label:'ğŸ›ï¸',bg:'#e0f7fa',color:'#00838f'}].map(c => `<span class="expense-cat ${c.id === 'all' ? 'active' : ''}" style="background:${c.bg};color:${c.color}" onclick="filterExpenses('${c.id}')">${c.label}</span>`).join('');
}

function filterExpenses(cat) { currentExpenseFilter = cat; document.querySelectorAll('.expense-cat').forEach(c => c.classList.remove('active')); event.target.classList.add('active'); renderExpenses(); }

function renderExpenses() {
  const filtered = currentExpenseFilter === 'all' ? expenses : expenses.filter(e => e.category === currentExpenseFilter);
  const icons = {flight:'âœˆï¸',hotel:'ğŸ¨',car:'ğŸš—',food:'ğŸ½ï¸',ticket:'ğŸ«',shopping:'ğŸ›ï¸',other:'ğŸ“¦'};
  const colors = {flight:'#e3f2fd',hotel:'#f3e5f5',car:'#e8f5e9',food:'#fff3e0',ticket:'#fce4ec',shopping:'#e0f7fa',other:'#eceff1'};
  if (filtered.length === 0) { document.getElementById('expense-list').innerHTML = '<div class="expense-empty">æ²’æœ‰æ¶ˆè²»è¨˜éŒ„</div>'; return; }
  document.getElementById('expense-list').innerHTML = filtered.map(e => `<div class="expense-item"><div class="expense-left"><div class="expense-icon" style="background:${colors[e.category] || '#eceff1'}">${icons[e.category] || 'ğŸ“¦'}</div><div class="expense-info"><div class="expense-desc">${e.description}</div><div class="expense-date">${e.date}</div></div></div><div class="expense-amount ${e.currency.toLowerCase()}">${e.currency === 'TWD' ? 'NT$' : 'Â¥'}${Number(e.amount).toLocaleString()}</div><button class="expense-delete" onclick="deleteExpense('${e.id}')">ğŸ—‘ï¸</button></div>`).join('');
}

function updateBudget() {
  const rate = 0.21; let t = {flight:0,hotel:0,car:0,food:0,ticket:0,shopping:0,other:0};
  expenses.forEach(e => { const amt = e.currency === 'TWD' ? Number(e.amount) : Math.round(Number(e.amount) * rate); if (t[e.category] !== undefined) t[e.category] += amt; });
  let carJPY = 0; expenses.filter(e => e.category === 'car').forEach(e => { if (e.currency === 'JPY') carJPY += Number(e.amount); else carJPY += Math.round(Number(e.amount) / rate); });
  const total = Object.values(t).reduce((a, b) => a + b, 0);
  document.getElementById('b-flight').textContent = `NT$${t.flight.toLocaleString()}`;
  document.getElementById('b-hotel').textContent = `NT$${t.hotel.toLocaleString()}`;
  document.getElementById('b-car').textContent = `Â¥${carJPY.toLocaleString()}`;
  document.getElementById('b-food').textContent = `NT$${t.food.toLocaleString()}`;
  document.getElementById('b-ticket').textContent = `NT$${t.ticket.toLocaleString()}`;
  document.getElementById('b-total').textContent = `NT$${total.toLocaleString()}`;
}

function renderInfo() {
  document.getElementById('page-info').innerHTML = `<div class="info-card"><div class="info-header">ğŸš¨ ç·Šæ€¥é›»è©±</div><div class="emergency-box"><h4>è­¦å¯Ÿ</h4><p>110</p></div><div class="emergency-box" style="background:#ff6d00"><h4>æ¶ˆé˜²/æ•‘è­·è»Š</h4><p>119</p></div><div class="info-body"><div class="info-row"><span class="info-label">é§æ—¥ä»£è¡¨è™•</span><span class="info-value">03-2280-7917</span></div></div></div><div class="info-card"><div class="info-header">ğŸŒ¡ï¸ å¤©æ°£åƒè€ƒ</div><div class="info-body"><div class="info-row"><span class="info-label">å¯Œè‰¯é‡/ç¾ç‘›</span><span class="info-value">-15~-5Â°C</span></div><div class="info-row"><span class="info-label">æ—­å·</span><span class="info-value">-12~-3Â°C</span></div><div class="info-row"><span class="info-label">å±¤é›²å³½</span><span class="info-value">-18~-8Â°C</span></div><div class="info-row"><span class="info-label">é˜¿å¯’æ¹–</span><span class="info-value">-20~-10Â°C</span></div><div class="info-row"><span class="info-label">æœ­å¹Œ</span><span class="info-value">-8~0Â°C</span></div></div></div><div class="info-card"><div class="info-header">ğŸ’¡ å¯¦ç”¨è³‡è¨Š</div><div class="info-body"><div class="info-row"><span class="info-label">åŒ¯ç‡åƒè€ƒ</span><span class="info-value">Â¥100â‰ˆNT$21</span></div><div class="info-row"><span class="info-label">é›»å£“</span><span class="info-value">100V é›™æ‰æ’</span></div><div class="info-row"><span class="info-label">æ™‚å·®</span><span class="info-value">æ¯”å°ç£å¿«1å°æ™‚</span></div><div class="info-row"><span class="info-label">å…ç¨…æ¢ä»¶</span><span class="info-value">åŒåº—æ»¿Â¥5,000</span></div></div></div><div class="info-card"><div class="info-header">ğŸš— é›ªåœ°é§•é§›æ³¨æ„</div><div class="info-body"><div class="info-row"><span class="info-label">é€Ÿåº¦</span><span class="info-value">æ¯”å¹³å¸¸æ…¢20-30%</span></div><div class="info-row"><span class="info-label">ç…è»Š</span><span class="info-value">ææ—©è¼•è¸©é¿å…æ€¥ç…</span></div><div class="info-row"><span class="info-label">è»Šè·</span><span class="info-value">ä¿æŒ3å€ä»¥ä¸Šè·é›¢</span></div><div class="info-row"><span class="info-label">åœè»Š</span><span class="info-value">ä¸æ”¾æ‰‹ç…è»Š(æœƒçµå†°)</span></div><div class="info-row"><span class="info-label">åŠ æ²¹</span><span class="info-value">é¸ã€Œãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼ã€</span></div></div></div><div class="info-card"><div class="info-header">ğŸ“ å°æé†’</div><div class="info-body" style="padding:16px"><div style="font-size:15px;line-height:2;color:#546e7a">ğŸ”¸ ä¾¿åˆ©å•†åº—24å°æ™‚å¯è²·ç†±é£Ÿã€ææ¬¾<br>ğŸ”¸ æ³¡æº«æ³‰å‰å…ˆæ·‹æµ´ï¼Œæ¯›å·¾ä¸å…¥æ± <br>ğŸ”¸ é¤å»³ç”¨é¤ç„¡éœ€çµ¦å°è²»<br>ğŸ”¸ DCMå¯è²·é‹é‡˜ï¼ˆé˜²æ»‘ç”¨ï¼‰</div></div></div>`;
}

function saveApiUrl() { const url = document.getElementById('api-url').value.trim(); if (!url) { showSetupStatus('è«‹è¼¸å…¥ç¶²å€', 'error'); return; } API_URL = url; localStorage.setItem(STORAGE_KEY, url); showSetupStatus('å·²å„²å­˜ï¼æ­£åœ¨æ¸¬è©¦...', 'success'); testConnection(); }

async function testConnection() {
  if (!API_URL) { showSetupStatus('è«‹å…ˆè¼¸å…¥ç¶²å€', 'error'); return; }
  updateConnStatus('loading');
  try {
    const response = await fetch(`${API_URL}?action=get`);
    const data = await response.json();
    if (data.success) { isOnline = true; updateConnStatus('online'); showSetupStatus(`é€£ç·šæˆåŠŸï¼${data.expenses.length} ç­†è³‡æ–™`, 'success'); document.getElementById('setup-section').innerHTML = ''; if (data.expenses.length === 0) { initDefaultData(); } else { expenses = data.expenses; renderExpenses(); updateBudget(); } }
    else { throw new Error(data.error || 'é€£ç·šå¤±æ•—'); }
  } catch (error) { isOnline = false; updateConnStatus('error'); showSetupStatus('é€£ç·šå¤±æ•—ï¼š' + error.message, 'error'); }
}

async function initDefaultData() { try { const response = await fetch(`${API_URL}?action=init`); const data = await response.json(); if (data.success) { showToast('å·²åˆå§‹åŒ–è³‡æ–™', 'success'); syncData(); } } catch (error) { console.error(error); } }

async function syncData() {
  if (!API_URL) return;
  document.getElementById('header-sync').classList.add('loading');
  try {
    const response = await fetch(`${API_URL}?action=get`);
    const data = await response.json();
    if (data.success) { expenses = data.expenses; isOnline = true; updateConnStatus('online'); renderExpenses(); updateBudget(); showToast('åŒæ­¥æˆåŠŸï¼', 'success'); } else { throw new Error(data.error); }
  } catch (error) { isOnline = false; updateConnStatus('error'); showToast('åŒæ­¥å¤±æ•—', 'error'); }
  finally { document.getElementById('header-sync').classList.remove('loading'); }
}

function updateConnStatus(status) {
  const el = document.getElementById('conn-status');
  if (status === 'online') { el.className = 'expense-status online'; el.innerHTML = '<span>ğŸŸ¢</span> å·²é€£ç·š'; }
  else if (status === 'error') { el.className = 'expense-status error'; el.innerHTML = '<span>ğŸ”´</span> é›¢ç·š'; }
  else { el.className = 'expense-status offline'; el.innerHTML = '<span>â³</span> é€£ç·šä¸­...'; }
}

function showSetupStatus(msg, type) { const el = document.getElementById('setup-status'); if (el) { el.style.display = 'block'; el.className = 'setup-status ' + type; el.textContent = msg; } }

function openModal() { if (!isOnline) { showToast('è«‹å…ˆè¨­å®šé€£ç·š', 'error'); return; } document.getElementById('modal').classList.add('active'); document.getElementById('f-date').value = new Date().toISOString().split('T')[0]; }
function closeModal() { document.getElementById('modal').classList.remove('active'); }

async function addExpense(e) {
  e.preventDefault();
  const btn = document.getElementById('submit-btn'); btn.disabled = true; btn.textContent = 'æ–°å¢ä¸­...';
  const params = new URLSearchParams({ action: 'add', id: Date.now().toString(), date: document.getElementById('f-date').value, category: document.getElementById('f-cat').value, description: document.getElementById('f-desc').value, currency: document.getElementById('f-cur').value, amount: document.getElementById('f-amt').value });
  try { const response = await fetch(`${API_URL}?${params}`); const data = await response.json(); if (data.success) { showToast('æ–°å¢æˆåŠŸï¼', 'success'); closeModal(); document.querySelector('form').reset(); syncData(); } else { throw new Error(data.error); } }
  catch (error) { showToast('æ–°å¢å¤±æ•—', 'error'); }
  finally { btn.disabled = false; btn.textContent = 'æ–°å¢æ¶ˆè²»'; }
}

async function deleteExpense(id) {
  if (!confirm('ç¢ºå®šåˆªé™¤ï¼Ÿ')) return;
  try { const response = await fetch(`${API_URL}?action=delete&id=${id}`); const data = await response.json(); if (data.success) { showToast('å·²åˆªé™¤', 'success'); syncData(); } else { throw new Error(data.error); } }
  catch (error) { showToast('åˆªé™¤å¤±æ•—', 'error'); }
}

function showToast(msg, type = '') { const toast = document.getElementById('toast'); toast.textContent = msg; toast.className = 'toast show ' + type; setTimeout(() => toast.className = 'toast', 2500); }

document.getElementById('modal').addEventListener('click', (e) => { if (e.target.id === 'modal') closeModal(); });
document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
