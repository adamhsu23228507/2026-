<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>åŒ—æµ·é“2026</title>
<style>
:root{--ice:#e3f2fd;--blue:#1976d2;--navy:#0d47a1;--orange:#ff6d00;--red:#e53935;--purple:#7c4dff;--green:#00c853;--gray:#546e7a;--light:#90a4ae;--bg:#f5f5f5}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{height:100%;overflow:hidden}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:var(--bg);color:#263238;font-size:16px;line-height:1.5}
.app{display:flex;flex-direction:column;height:100%;max-width:500px;margin:0 auto;background:#fff;box-shadow:0 0 20px rgba(0,0,0,.1)}
.header{background:linear-gradient(135deg,var(--blue),var(--navy));color:#fff;padding:12px 16px;display:flex;align-items:center;gap:10px;flex-shrink:0}
.header-icon{font-size:28px}.header-title{font-size:18px;font-weight:700}.header-sub{font-size:12px;opacity:.85}
.header-sync{margin-left:auto;background:rgba(255,255,255,.2);border:none;color:#fff;width:36px;height:36px;border-radius:50%;font-size:18px;cursor:pointer}
.header-sync.loading{animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.content{flex:1;overflow-y:auto;overflow-x:hidden;-webkit-overflow-scrolling:touch}
.page{display:none;padding:16px;padding-bottom:80px;min-height:100%}.page.active{display:block}
.nav{position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:100%;max-width:500px;background:#fff;display:flex;border-top:1px solid #e0e0e0;box-shadow:0 -2px 10px rgba(0,0,0,.05);z-index:100}
.nav-item{flex:1;padding:8px 4px;text-align:center;color:var(--gray);text-decoration:none}.nav-item.active{color:var(--blue)}
.nav-item span{display:block;font-size:22px;margin-bottom:2px}.nav-item small{font-size:10px}
.carousel{position:relative;width:100%;height:180px;overflow:hidden;background:linear-gradient(135deg,#e1bee7,#ce93d8)}
.carousel-inner{display:flex;transition:transform .4s ease;height:100%}
.carousel-slide{min-width:100%;height:100%}.carousel-slide img{width:100%;height:100%;object-fit:cover}
.carousel-btn{position:absolute;top:50%;transform:translateY(-50%);background:rgba(0,0,0,.4);color:#fff;border:none;width:32px;height:32px;border-radius:50%;font-size:16px;cursor:pointer;z-index:10}
.carousel-btn.prev{left:6px}.carousel-btn.next{right:6px}
.carousel-dots{position:absolute;bottom:8px;left:50%;transform:translateX(-50%);display:flex;gap:5px;z-index:10}
.carousel-dot{width:6px;height:6px;border-radius:50%;background:rgba(255,255,255,.5)}.carousel-dot.active{background:#fff;width:16px;border-radius:3px}
.carousel-counter{position:absolute;top:8px;right:8px;background:rgba(0,0,0,.5);color:#fff;padding:3px 8px;border-radius:10px;font-size:11px;z-index:10}
.hotel-card{background:#fff;border-radius:16px;margin-bottom:16px;box-shadow:0 2px 12px rgba(0,0,0,.08);overflow:hidden}
.hotel-header{padding:12px 16px;color:#fff;background:linear-gradient(135deg,var(--purple),#512da8)}
.hotel-header.warn{background:linear-gradient(135deg,#ff6d00,#f57c00)}
.hotel-date{font-size:12px;opacity:.9}.hotel-name{font-size:17px;font-weight:700;margin-top:2px}
.hotel-body{padding:16px}
.hotel-info{font-size:14px;color:var(--gray);line-height:1.8}
.hotel-desc{font-size:14px;color:#455a64;margin:12px 0;line-height:1.7;padding:12px;background:#f8f9fa;border-radius:10px}
.hotel-tags{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}
.hotel-tag{background:var(--ice);color:var(--blue);padding:4px 10px;border-radius:12px;font-size:13px}
.hotel-tag.warn{background:#fff3e0;color:#e65100}.hotel-tag.no{background:#ffebee;color:#c62828}
.hotel-nearby{margin-top:14px;padding-top:14px;border-top:1px dashed #e0e0e0}
.hotel-nearby-title{font-size:13px;font-weight:600;color:var(--gray);margin-bottom:10px}
.nearby-item{display:flex;align-items:center;gap:8px;padding:8px 0;font-size:14px;border-bottom:1px solid #f5f5f5}
.nearby-item:last-child{border-bottom:none}
.nearby-icon{font-size:18px}.nearby-name{flex:1;color:#455a64}.nearby-dist{color:var(--light);font-size:12px}
.nearby-nav{color:var(--green);font-size:13px;text-decoration:none;font-weight:500}
.hotel-price{display:flex;justify-content:space-between;align-items:center;margin-top:14px;padding-top:14px;border-top:1px dashed #e0e0e0}
.hotel-price-label{font-size:14px;color:var(--gray)}.hotel-price-value{font-size:20px;font-weight:700;color:var(--red)}
.hotel-nav-btn{display:flex;align-items:center;justify-content:center;gap:8px;width:100%;padding:12px;background:linear-gradient(135deg,var(--green),#00e676);color:#fff;border:none;border-radius:12px;font-size:15px;font-weight:600;cursor:pointer;margin-top:14px;text-decoration:none}
.spot-card{background:#fff;border-radius:16px;margin-bottom:16px;box-shadow:0 2px 12px rgba(0,0,0,.08);overflow:hidden}
.spot-body{padding:16px}
.spot-region{display:inline-block;background:var(--blue);color:#fff;padding:4px 12px;border-radius:12px;font-size:12px;margin-bottom:10px}
.spot-name{font-size:20px;font-weight:700}.spot-jp{font-size:14px;color:var(--light);margin-top:2px}
.spot-desc{font-size:15px;color:var(--gray);margin:12px 0;line-height:1.7}
.spot-info-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin:12px 0;padding:12px;background:var(--ice);border-radius:12px}
.spot-info-item{font-size:14px}.spot-info-label{color:var(--light);font-size:12px}.spot-info-value{font-weight:600;margin-top:2px}
.spot-tips{background:#fff3e0;border-radius:12px;padding:12px;margin:12px 0}
.spot-tips-title{font-size:13px;font-weight:600;color:var(--orange);margin-bottom:6px}
.spot-tips-content{font-size:14px;color:#795548;line-height:1.6}
.spot-nav-btn{display:flex;align-items:center;justify-content:center;gap:8px;width:100%;padding:14px;background:linear-gradient(135deg,var(--green),#00e676);color:#fff;border:none;border-radius:12px;font-size:16px;font-weight:600;cursor:pointer;margin-top:12px;text-decoration:none}
.card{background:#fff;border-radius:16px;margin-bottom:16px;box-shadow:0 2px 12px rgba(0,0,0,.08);overflow:hidden}
.card-header{padding:14px 16px;color:#fff;background:linear-gradient(135deg,var(--blue),var(--navy))}
.card-title{font-size:17px;font-weight:700}.card-sub{font-size:13px;opacity:.9;margin-top:2px}
.card-body{padding:16px}
.timeline{position:relative;padding-left:24px}
.timeline::before{content:'';position:absolute;left:7px;top:4px;bottom:4px;width:2px;background:linear-gradient(var(--ice),var(--blue))}
.tl-item{position:relative;padding-bottom:16px}.tl-item:last-child{padding-bottom:0}
.tl-dot{position:absolute;left:-20px;top:4px;width:12px;height:12px;background:#fff;border:3px solid var(--blue);border-radius:50%}
.tl-item.meal .tl-dot{border-color:var(--orange)}.tl-item.hotel .tl-dot{border-color:var(--purple)}
.tl-time{font-size:13px;color:var(--light);font-weight:500}
.tl-title{font-size:16px;font-weight:600;margin:2px 0}.tl-desc{font-size:14px;color:var(--gray)}
.tl-link{display:inline-flex;align-items:center;gap:4px;margin-top:6px;padding:6px 12px;background:var(--ice);color:var(--blue);text-decoration:none;border-radius:20px;font-size:13px}
.day-selector{display:flex;gap:8px;overflow-x:auto;padding-bottom:16px;margin-bottom:16px;-webkit-overflow-scrolling:touch}
.day-selector::-webkit-scrollbar{display:none}
.day-btn{flex-shrink:0;width:50px;padding:12px 8px;background:#fff;border:2px solid #e0e0e0;border-radius:12px;text-align:center;cursor:pointer}
.day-btn.active{background:var(--blue);border-color:var(--blue);color:#fff}
.day-btn-num{font-size:18px;font-weight:700}.day-btn-date{font-size:10px;opacity:.7;margin-top:2px}
.trans-box{background:#fff;border-radius:16px;margin-bottom:12px;box-shadow:0 2px 12px rgba(0,0,0,.08);padding:16px}
.trans-title{font-size:16px;font-weight:700;margin-bottom:12px}
.trans-row{display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid #f0f0f0;font-size:15px}
.trans-row:last-child{border-bottom:none}
.trans-label{color:var(--gray)}.trans-value{font-weight:600}.trans-value.red{color:var(--red)}
.route-table{width:100%;border-collapse:collapse;font-size:14px;margin-top:12px}
.route-table th,.route-table td{padding:10px 8px;text-align:left}
.route-table thead{background:var(--ice)}.route-table tbody tr{border-bottom:1px solid #f0f0f0}
.route-table tfoot{background:var(--navy);color:#fff}
.route-table td:last-child,.route-table th:last-child{text-align:right}
.phrase-tabs{display:flex;gap:8px;overflow-x:auto;padding-bottom:12px;margin-bottom:16px}
.phrase-tabs::-webkit-scrollbar{display:none}
.phrase-tab{flex-shrink:0;padding:10px 16px;background:#fff;border:2px solid #e0e0e0;border-radius:25px;font-size:14px;color:var(--gray);cursor:pointer}
.phrase-tab.active{background:var(--blue);border-color:var(--blue);color:#fff}
.phrase-card{background:#fff;border-radius:16px;margin-bottom:12px;padding:16px;box-shadow:0 2px 12px rgba(0,0,0,.08);border-left:4px solid var(--blue);cursor:pointer}
.phrase-card.driving{border-color:var(--green)}.phrase-card.restaurant{border-color:var(--orange)}
.phrase-card.onsen{border-color:#ffab91}.phrase-card.shopping{border-color:var(--purple)}.phrase-card.emergency{border-color:var(--red)}
.phrase-jp{font-size:18px;font-weight:700}.phrase-romaji{font-size:13px;color:var(--light);font-style:italic;margin:4px 0}
.phrase-zh{font-size:15px;color:var(--gray)}.phrase-play{display:flex;align-items:center;gap:6px;margin-top:10px;color:var(--blue);font-size:14px}
.budget-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:16px}
.budget-card{background:#fff;border-radius:16px;padding:14px 10px;text-align:center;box-shadow:0 2px 12px rgba(0,0,0,.08)}
.budget-card.total{grid-column:span 3;background:linear-gradient(135deg,var(--blue),var(--navy));color:#fff}
.budget-icon{font-size:24px;margin-bottom:4px}.budget-label{font-size:12px;opacity:.7}.budget-value{font-size:16px;font-weight:700;margin-top:2px}
.expense-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.expense-title{font-size:17px;font-weight:700}
.expense-add-btn{background:var(--green);color:#fff;border:none;padding:10px 20px;border-radius:25px;font-size:15px;font-weight:600;cursor:pointer}
.expense-status{display:flex;align-items:center;gap:6px;font-size:13px;padding:6px 12px;border-radius:20px;margin-bottom:12px}
.expense-status.online{background:#e8f5e9;color:#2e7d32}.expense-status.offline{background:#fff3e0;color:#e65100}.expense-status.error{background:#ffebee;color:#c62828}
.expense-cats{display:flex;gap:8px;overflow-x:auto;padding-bottom:12px;margin-bottom:12px}
.expense-cats::-webkit-scrollbar{display:none}
.expense-cat{flex-shrink:0;padding:8px 14px;border-radius:20px;font-size:14px;cursor:pointer}.expense-cat.active{box-shadow:0 2px 8px rgba(0,0,0,.2)}
.expense-list{background:#fff;border-radius:16px;box-shadow:0 2px 12px rgba(0,0,0,.08);overflow:hidden}
.expense-item{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;border-bottom:1px solid #f0f0f0}
.expense-item:last-child{border-bottom:none}
.expense-left{display:flex;align-items:center;gap:12px}
.expense-icon{width:40px;height:40px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:20px}
.expense-desc{font-size:15px;font-weight:500}.expense-date{font-size:12px;color:var(--light);margin-top:2px}
.expense-amount{font-size:17px;font-weight:700}.expense-amount.twd{color:var(--red)}.expense-amount.jpy{color:var(--blue)}
.expense-delete{background:none;border:none;font-size:20px;color:var(--light);padding:8px;cursor:pointer}
.expense-empty{text-align:center;padding:40px 20px;color:var(--light)}
.info-card{background:#fff;border-radius:16px;margin-bottom:12px;box-shadow:0 2px 12px rgba(0,0,0,.08);overflow:hidden}
.info-header{padding:14px 16px;font-size:16px;font-weight:700;background:var(--ice)}
.info-body{padding:4px 0}
.info-row{display:flex;justify-content:space-between;padding:12px 16px;border-bottom:1px solid #f0f0f0;font-size:15px}
.info-row:last-child{border-bottom:none}
.info-label{color:var(--gray)}.info-value{font-weight:500}
.emergency-box{background:var(--red);color:#fff;padding:16px;text-align:center;margin:12px 16px;border-radius:12px}
.emergency-box h4{font-size:13px;opacity:.9}.emergency-box p{font-size:28px;font-weight:700;margin-top:4px}
.setup-card{background:#fff;border-radius:16px;padding:20px;margin-bottom:16px;box-shadow:0 2px 12px rgba(0,0,0,.08);border:2px dashed var(--orange)}
.setup-title{font-size:17px;font-weight:700;color:var(--orange);margin-bottom:12px}
.setup-steps{font-size:14px;color:var(--gray);line-height:2}
.setup-input{width:100%;padding:14px;border:2px solid #e0e0e0;border-radius:12px;font-size:15px;margin:12px 0}
.setup-input:focus{outline:none;border-color:var(--blue)}
.setup-btns{display:flex;gap:10px}
.setup-btn{flex:1;padding:14px;border:none;border-radius:12px;font-size:15px;font-weight:600;cursor:pointer}
.setup-btn.primary{background:var(--green);color:#fff}.setup-btn.secondary{background:var(--blue);color:#fff}
.setup-status{margin-top:12px;padding:12px;border-radius:10px;font-size:14px}
.setup-status.success{background:#e8f5e9;color:#2e7d32}.setup-status.error{background:#ffebee;color:#c62828}
.backup-box{background:linear-gradient(135deg,#fff3e0,#ffe0b2);border:2px solid var(--orange);border-radius:16px;padding:16px;margin-top:16px}
.backup-title{font-size:15px;font-weight:700;color:var(--orange);margin-bottom:6px}
.backup-text{font-size:14px;color:#795548}
.weather-card{background:#fff;border-radius:12px;margin-bottom:12px;box-shadow:0 2px 8px rgba(0,0,0,.06);overflow:hidden}
.weather-header{display:flex;justify-content:space-between;align-items:center;padding:10px 14px;background:linear-gradient(135deg,#4fc3f7,#0288d1);color:#fff}
.weather-title{font-size:14px;font-weight:600}
.weather-update{font-size:10px;opacity:.85}
.weather-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:1px;background:#e0e0e0}
.weather-item{background:#fff;padding:8px 6px;text-align:center}
.weather-label{font-size:10px;color:var(--light)}
.weather-value{font-size:13px;font-weight:600;margin-top:1px}
.weather-value.cold{color:#2196f3}.weather-value.warn{color:#ff9800}.weather-value.danger{color:#f44336}.weather-value.safe{color:#4caf50}
.weather-alert{padding:8px 14px;background:#ffebee;border-left:3px solid #f44336;font-size:13px;color:#c62828}
.weather-alert.warn{background:#fff3e0;border-color:#ff9800;color:#e65100}
.weather-alert.info{background:#e3f2fd;border-color:#2196f3;color:#1565c0}
.weather-alert.safe{background:#e8f5e9;border-color:#4caf50;color:#2e7d32}
.road-status{padding:10px 14px;border-top:1px solid #e0e0e0}
.road-title{font-size:12px;font-weight:600;color:var(--gray);margin-bottom:6px;display:flex;justify-content:space-between;align-items:center}
.road-item{display:inline-flex;align-items:center;gap:4px;padding:4px 8px;font-size:12px;background:#f5f5f5;border-radius:6px;margin:2px 4px 2px 0}
.road-dot{width:8px;height:8px;border-radius:50%}
.road-dot.open{background:#4caf50}.road-dot.caution{background:#ff9800}.road-dot.closed{background:#f44336}.road-dot.unknown{background:#9e9e9e}
.road-link{color:var(--blue);font-size:11px;text-decoration:none}
.food-tabs{display:flex;gap:8px;margin-bottom:16px}
.food-tab{flex:1;padding:10px;background:#fff;border:2px solid #e0e0e0;border-radius:12px;font-size:14px;text-align:center;cursor:pointer}
.food-tab.active{background:var(--orange);border-color:var(--orange);color:#fff}
.food-tab.shop.active{background:var(--purple);border-color:var(--purple)}
.food-card{background:#fff;border-radius:16px;margin-bottom:14px;box-shadow:0 2px 12px rgba(0,0,0,.08);overflow:hidden}
.food-header{display:flex;align-items:center;gap:12px;padding:14px 16px;background:linear-gradient(135deg,#ff8a65,#ff5722)}
.food-header.shop{background:linear-gradient(135deg,#b39ddb,#7c4dff)}
.food-icon{font-size:32px;background:rgba(255,255,255,.2);width:50px;height:50px;border-radius:12px;display:flex;align-items:center;justify-content:center}
.food-title{flex:1;color:#fff}
.food-name{font-size:17px;font-weight:700}
.food-jp{font-size:12px;opacity:.85}
.food-day{background:rgba(255,255,255,.25);padding:4px 10px;border-radius:20px;font-size:11px;color:#fff}
.food-body{padding:16px}
.food-desc{font-size:14px;color:#455a64;line-height:1.7;margin-bottom:12px}
.food-info{display:grid;grid-template-columns:1fr 1fr;gap:10px;padding:12px;background:#fafafa;border-radius:10px;margin-bottom:12px}
.food-info-item{font-size:13px}
.food-info-label{color:var(--light);font-size:11px}
.food-info-value{font-weight:500;margin-top:2px}
.food-tips{background:#fff3e0;padding:10px 12px;border-radius:10px;font-size:13px;color:#e65100;margin-bottom:12px}
.food-nav-btn{display:flex;align-items:center;justify-content:center;gap:6px;width:100%;padding:12px;background:linear-gradient(135deg,var(--green),#00e676);color:#fff;border:none;border-radius:10px;font-size:14px;font-weight:600;cursor:pointer;text-decoration:none}
.modal{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.5);z-index:200;justify-content:center;align-items:flex-end}
.modal.active{display:flex}
.modal-content{background:#fff;width:100%;max-width:500px;border-radius:24px 24px 0 0;padding:24px;padding-bottom:40px;max-height:90vh;overflow-y:auto}
.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
.modal-title{font-size:20px;font-weight:700}
.modal-close{background:none;border:none;font-size:28px;color:var(--light);cursor:pointer}
.form-group{margin-bottom:16px}
.form-label{display:block;font-size:14px;font-weight:500;margin-bottom:8px;color:var(--gray)}
.form-input,.form-select{width:100%;padding:14px;border:2px solid #e0e0e0;border-radius:12px;font-size:16px;background:#fff}
.form-input:focus,.form-select:focus{outline:none;border-color:var(--blue)}
.form-submit{width:100%;padding:16px;background:var(--blue);color:#fff;border:none;border-radius:12px;font-size:17px;font-weight:700;cursor:pointer}
.toast{position:fixed;bottom:100px;left:50%;transform:translateX(-50%);background:#333;color:#fff;padding:14px 24px;border-radius:25px;font-size:15px;z-index:300;opacity:0;transition:opacity .3s;pointer-events:none}
.toast.show{opacity:1}.toast.success{background:#4caf50}.toast.error{background:#f44336}
@media(max-width:400px){.budget-grid{grid-template-columns:repeat(2,1fr)}.budget-card.total{grid-column:span 2}}
</style>
</head>
<body>
<div class="app">
  <header class="header">
    <div class="header-icon">ğŸ¦Š</div>
    <div><div class="header-title">åŒ—æµ·é“è‡ªé§•ä¹‹æ—…</div><div class="header-sub">2026/1/28-2/4 ï½œ 4äºº</div></div>
    <button class="header-sync" id="header-sync" onclick="syncData()">ğŸ”„</button>
  </header>
  <div class="content">
    <div class="page active" id="page-itinerary"><div id="weather-box"></div><div class="day-selector" id="day-selector"></div><div id="day-content"></div><div class="backup-box"><div class="backup-title">âš ï¸ å‚™æ¡ˆè¨ˆç•«</div><div class="backup-text">è‹¥ç¬¬1å¤©ç­æ©Ÿå•é¡Œï¼Œå¯å–æ¶ˆå¯Œè‰¯é‡ä½å®¿ï¼Œç¬¬2å¤©å¾æ©Ÿå ´ç›´æ¥åˆ°æ—­å·ã€‚</div></div></div>
    <div class="page" id="page-hotels"></div>
    <div class="page" id="page-spots"></div>
    <div class="page" id="page-food"></div>
    <div class="page" id="page-transport"></div>
    <div class="page" id="page-phrases"><div class="phrase-tabs" id="phrase-tabs"></div><div id="phrases-list"></div></div>
    <div class="page" id="page-budget"><div id="setup-section"></div><div class="budget-grid" id="budget-grid"></div><div class="expense-header"><div class="expense-title">ğŸ“ æ¶ˆè²»è¨˜éŒ„</div><button class="expense-add-btn" onclick="openModal()">ï¼‹ æ–°å¢</button></div><div class="expense-status" id="conn-status"><span>â³</span> æœªé€£ç·š</div><div class="expense-cats" id="expense-cats"></div><div class="expense-list" id="expense-list"><div class="expense-empty">è«‹å…ˆè¨­å®š Google Sheets</div></div></div>
  </div>
  <nav class="nav">
    <a class="nav-item active" data-page="itinerary"><span>ğŸ“…</span><small>è¡Œç¨‹</small></a>
    <a class="nav-item" data-page="hotels"><span>ğŸ¨</span><small>ä½å®¿</small></a>
    <a class="nav-item" data-page="spots"><span>ğŸ“</span><small>æ™¯é»</small></a>
    <a class="nav-item" data-page="food"><span>ğŸ½ï¸</span><small>ç¾é£Ÿ</small></a>
    <a class="nav-item" data-page="transport"><span>ğŸš—</span><small>äº¤é€š</small></a>
    <a class="nav-item" data-page="phrases"><span>ğŸ’¬</span><small>æœƒè©±</small></a>
    <a class="nav-item" data-page="budget"><span>ğŸ’°</span><small>è¨˜å¸³</small></a>
  </nav>
</div>
<div class="modal" id="booking-modal">
  <div class="modal-content" style="max-height:95vh">
    <div class="modal-header"><div class="modal-title">ğŸ“„ è¨‚è³¼å–®æˆªåœ–</div><button class="modal-close" onclick="closeBookingModal()">Ã—</button></div>
    <div id="booking-content" style="text-align:center"></div>
  </div>
</div>
<div class="modal" id="modal">
  <div class="modal-content">
    <div class="modal-header"><div class="modal-title">ğŸ’° æ–°å¢æ¶ˆè²»</div><button class="modal-close" onclick="closeModal()">Ã—</button></div>
    <form onsubmit="addExpense(event)">
      <div class="form-group"><label class="form-label">æ—¥æœŸ</label><input type="date" class="form-input" id="f-date" required></div>
      <div class="form-group"><label class="form-label">åˆ†é¡</label><select class="form-select" id="f-cat"><option value="flight">âœˆï¸ æ©Ÿç¥¨</option><option value="hotel">ğŸ¨ ä½å®¿</option><option value="car">ğŸš— ç§Ÿè»Š</option><option value="food">ğŸ½ï¸ é¤é£²</option><option value="ticket">ğŸ« é–€ç¥¨</option><option value="shopping">ğŸ›ï¸ è³¼ç‰©</option><option value="other">ğŸ“¦ å…¶ä»–</option></select></div>
      <div class="form-group"><label class="form-label">èªªæ˜</label><input type="text" class="form-input" id="f-desc" placeholder="ä¾‹ï¼šæ—­å±±å‹•ç‰©åœ’é–€ç¥¨" required></div>
      <div class="form-group"><label class="form-label">å¹£åˆ¥</label><select class="form-select" id="f-cur"><option value="TWD">NT$ æ–°å°å¹£</option><option value="JPY">Â¥ æ—¥åœ“</option></select></div>
      <div class="form-group"><label class="form-label">é‡‘é¡</label><input type="number" class="form-input" id="f-amt" placeholder="0" required></div>
      <button type="submit" class="form-submit" id="submit-btn">æ–°å¢æ¶ˆè²»</button>
    </form>
  </div>
</div>
<div class="toast" id="toast"></div>
<script>
const STORAGE_KEY='hokkaido2026_api',IMG_BASE='./images/';
let API_URL=localStorage.getItem(STORAGE_KEY)||'',expenses=[],isOnline=false,currentDay=1,currentPhraseFilter='all',currentExpenseFilter='all',weatherData=null,lastWeatherUpdate=null;

// æ¯å¤©çš„ä¸»è¦åœ°é»åº§æ¨™ (ç”¨æ–¼å¤©æ°£æŸ¥è©¢)
const dayLocations=[
  {day:1,name:'å¯Œè‰¯é‡',lat:43.3421,lon:142.3831,roads:['é“å¤®é“','åœ‹é“38è™Ÿ']},
  {day:2,name:'æ—­å·',lat:43.7707,lon:142.3650,roads:['åœ‹é“237è™Ÿ','é“é“1160è™Ÿ']},
  {day:3,name:'å±¤é›²å³½',lat:43.7275,lon:142.9542,roads:['åœ‹é“39è™Ÿ','å±¤é›²å³½é“è·¯']},
  {day:4,name:'é˜¿å¯’æ¹–',lat:43.4333,lon:144.1000,roads:['åœ‹é“39è™Ÿ','åœ‹é“240è™Ÿ','åœ‹é“241è™Ÿ']},
  {day:5,name:'åå‹å·',lat:42.9333,lon:143.2167,roads:['åœ‹é“241è™Ÿ','åœ‹é“38è™Ÿ']},
  {day:6,name:'æœ­å¹Œ',lat:43.0618,lon:141.3545,roads:['é“æ±é“','é“å¤®é“']},
  {day:7,name:'åƒæ­²',lat:42.8206,lon:141.6500,roads:['åœ‹é“36è™Ÿ','é“å¤®é“']},
  {day:8,name:'æ–°åƒæ­²',lat:42.7752,lon:141.6928,roads:['åœ‹é“36è™Ÿ']}
];

const hotels=[
  {id:'laterre',date:'1/28',nights:'1æ™š',name:'å¯Œè‰¯é‡æ‹‰æ¼æ‘é…’åº—',jp:'ãµã‚‰ã®ãƒ©ãƒ†ãƒ¼ãƒ«',location:'åŒ—æµ·é“ç©ºçŸ¥éƒ¡ä¸­å¯Œè‰¯é‡ç”ºæ±1ç·šåŒ—18å·',room:'4äººæ¦»æ¦»ç±³',booking:'EZè¨‚æˆ¿',images:[IMG_BASE+'laterre-1.jpg',IMG_BASE+'laterre-2.jpg',IMG_BASE+'laterre-3.jpg'],desc:'100%å¤©ç„¶æº«æ³‰ï¼Œå¯çœºæœ›åå‹å²³é€£å³°ã€‚å®¤å…§æœ‰15ç¨®æº«æ³‰æµ´æ§½ï¼Œéœ²å¤©é¢¨å‘‚å¯è³é›ªæ™¯ã€‚ä½¿ç”¨ç•¶åœ°æ–°é®®è”¬èœçš„æ–™ç†ä¹Ÿå¾ˆå—æ­¡è¿ã€‚',tags:['â™¨ï¸æº«æ³‰','ğŸ³æ—©é¤','ğŸ½ï¸æ™šé¤','ğŸ…¿ï¸å…è²»åœè»Š'],nearby:[{icon:'ğŸª',name:'Seicomartä¾¿åˆ©å•†åº—',dist:'è»Šç¨‹5åˆ†',nav:'ã‚»ã‚¤ã‚³ãƒ¼ãƒãƒ¼ãƒˆä¸­å¯Œè‰¯é‡'},{icon:'ğŸœ',name:'å”¯æˆ‘ç¨å°Šå’–å“©',dist:'è»Šç¨‹10åˆ†',nav:'å”¯æˆ‘ç‹¬å°Š å¯Œè‰¯é‡'},{icon:'ğŸŒ¸',name:'å¯Œç”°è¾²å ´',dist:'è»Šç¨‹8åˆ†',nav:'ãƒ•ã‚¡ãƒ¼ãƒ å¯Œç”°'}],price:7000},
  {id:'asahikawa',date:'1/29',nights:'1æ™š',name:'æ—­å·å®¢æ¨‚æ£®é…’åº—',jp:'ã‚¯ãƒ¬ãƒƒã‚»ãƒ³ãƒˆæ—­å·',location:'åŒ—æµ·é“æ—­å·å¸‚5æ¡é€š8ä¸ç›®',room:'2é–“é›™äººæˆ¿',booking:'Agoda',extra:'å·²è²·2æ—©é¤',images:[IMG_BASE+'asahikawa-h-1.jpg',IMG_BASE+'asahikawa-h-2.jpg',IMG_BASE+'asahikawa-h-3.jpg'],desc:'ä½æ–¼æ—­å·å¸‚ä¸­å¿ƒï¼Œé„°è¿‘å¹³å’Œé€šè²·ç‰©å…¬åœ’å•†åº—è¡—ã€‚æ­¥è¡Œå¯åˆ°å¤šé–“é¤å»³å’Œè³¼ç‰©ä¸­å¿ƒã€‚',tags:['â™¨ï¸æº«æ³‰','ğŸ…¿ï¸ä»˜è²»åœè»Š'],nearby:[{icon:'ğŸª',name:'Lawsonä¾¿åˆ©å•†åº—',dist:'æ­¥è¡Œ1åˆ†',nav:'ãƒ­ãƒ¼ã‚½ãƒ³æ—­å·äº”æ¡é€š'},{icon:'ğŸ›’',name:'AEONè³¼ç‰©ä¸­å¿ƒ',dist:'æ­¥è¡Œ5åˆ†',nav:'ã‚¤ã‚ªãƒ³æ—­å·é§…å‰'},{icon:'ğŸ–',name:'å¤§é»‘å±‹æˆå‰æ€æ±—',dist:'æ­¥è¡Œ8åˆ†',nav:'å¤§é»’å±‹ æ—­å·'},{icon:'ğŸ”§',name:'DCM(è²·é‹é‡˜)',dist:'è»Šç¨‹10åˆ†',nav:'DCMãƒ›ãƒ¼ãƒãƒƒã‚¯æ—­å·'}],price:4643,priceNote:'NT$1,881+NT$2,762'},
  {id:'sounkyo',date:'1/30',nights:'1æ™š',name:'å±¤é›²å³½æœé™½äº­',jp:'å±¤é›²å³¡æœé™½äº­',location:'åŒ—æµ·é“ä¸Šå·éƒ¡ä¸Šå·ç”ºå±¤é›²å³¡æ¸©æ³‰',room:'4äººæˆ¿5åºŠ',booking:'EZè¨‚æˆ¿',images:[IMG_BASE+'sounkyo-h-1.jpg',IMG_BASE+'sounkyo-h-2.jpg',IMG_BASE+'sounkyo-h-3.jpg'],desc:'åè½æ–¼ç¾¤å±±ç’°æŠ±ä¸­çš„å±±å²³åº¦å‡é£¯åº—ã€‚å¤©ç©ºéœ²å¤©ã€Œæœé™½å±±ã€å¯çœºæœ›å±¤é›²å³½æºªè°·ç¾æ™¯ã€‚é™„è¿‘ç„¡å•†åº—ï¼Œä½†é£¯åº—å…§æœ‰åœŸç”¢åº—ã€å±…é…’å±‹ã€éºµåº—ã€‚',tags:['â™¨ï¸æº«æ³‰','ğŸ³æ—©é¤','ğŸ½ï¸æ™šé¤','ğŸ…¿ï¸å…è²»åœè»Š'],nearby:[{icon:'ğŸª',name:'é£¯åº—å…§åœŸç”¢åº—',dist:'é¤¨å…§1F',nav:''},{icon:'ğŸœ',name:'é£¯åº—å…§æ‹‰éºµåº—',dist:'é¤¨å…§B1',nav:''},{icon:'ğŸ§Š',name:'å†°ç€‘ç¥­æœƒå ´',dist:'æ­¥è¡Œ10åˆ†',nav:'å±¤é›²å³¡æ°·ç€‘ã¾ã¤ã‚Š'}],price:9591},
  {id:'akan',date:'1/31',nights:'1æ™š',name:'æ–°é˜¿å¯’é£¯åº—',jp:'ãƒ‹ãƒ¥ãƒ¼é˜¿å¯’ãƒ›ãƒ†ãƒ«',location:'åŒ—æµ·é“é‡§è·¯å¸‚é˜¿å¯’ç”ºé˜¿å¯’æ¹–æ¸©æ³‰2-8-8',room:'4äººå’Œå®¤',booking:'EZè¨‚æˆ¿',images:[IMG_BASE+'akan-h-1.jpg',IMG_BASE+'akan-h-2.jpg',IMG_BASE+'akan-h-3.jpg'],desc:'é˜¿å¯’æ¹–ç•”é«˜ç´šæº«æ³‰é£¯åº—ï¼Œæˆ¿é–“å¯çœºæœ›æ¹–æ™¯èˆ‡é›„é˜¿å¯’å²³ã€‚å±‹é ‚æœ‰ç©ºä¸­èŠ±åœ’æº«æ³‰å’Œæ³³æ± ã€‚é£¯åº—å°é¢æœ‰ä¾¿åˆ©å•†åº—ï¼',tags:['â™¨ï¸æº«æ³‰','ğŸ³æ—©é¤','ğŸ½ï¸æ™šé¤','ğŸŠæ³³æ± ','ğŸ…¿ï¸å…è²»åœè»Š'],nearby:[{icon:'ğŸª',name:'Lawsonä¾¿åˆ©å•†åº—',dist:'é£¯åº—å°é¢',nav:'ãƒ­ãƒ¼ã‚½ãƒ³é˜¿å¯’æ¹–æ¸©æ³‰'},{icon:'ğŸ’Š',name:'è—¥å¦åº—',dist:'æ­¥è¡Œ2åˆ†',nav:'é˜¿å¯’æ¹–æ¸©æ³‰å•†åº—è¡—'},{icon:'ğŸ˜ï¸',name:'æ„›åŠªæ‘è½Kotan',dist:'æ­¥è¡Œ8åˆ†',nav:'é˜¿å¯’æ¹–ã‚¢ã‚¤ãƒŒã‚³ã‚¿ãƒ³'},{icon:'ğŸš¢',name:'é˜¿å¯’æ¹–éŠè¦½èˆ¹',dist:'æ­¥è¡Œ5åˆ†',nav:'é˜¿å¯’è¦³å…‰æ±½èˆ¹'}],price:10545},
  {id:'tokachi',date:'2/1',nights:'1æ™š',name:'åå‹å·Tetra Resort',jp:'ãƒ†ãƒˆãƒ©ãƒªã‚¾ãƒ¼ãƒˆåå‹å·',location:'åŒ—æµ·é“æ²³æ±éƒ¡éŸ³æ›´ç”ºåå‹å·æ¸©æ³‰åŒ—9-1',room:'4äººæˆ¿',booking:'Agoda',images:[IMG_BASE+'tokachi-1.jpg',IMG_BASE+'tokachi-2.jpg',IMG_BASE+'tokachi-3.jpg'],desc:'ä½æ–¼ç™½é³¥é£›ä¾†çš„åå‹å·æ²³ç•”ã€‚è‡ªå®¶æºæ³‰å¤©ç„¶æº«æ³‰æ°´è³ªæŸ”æ»‘ã€‚å‘¨é‚Šè¼ƒåï¼Œå»ºè­°å…ˆåœ¨å¸¶å»£å¸‚å€ç”¨é¤è³¼ç‰©ã€‚',tags:['ğŸ›æµ´å ´','ğŸ³æ—©é¤','ğŸ…¿ï¸å…è²»åœè»Š'],nearby:[{icon:'ğŸª',name:'Seicomartä¾¿åˆ©å•†åº—',dist:'è»Šç¨‹5åˆ†',nav:'ã‚»ã‚¤ã‚³ãƒ¼ãƒãƒ¼ãƒˆéŸ³æ›´æœ¨é‡'},{icon:'âœ¨',name:'åå‹å·å½©ç‡ˆç¥­',dist:'æ­¥è¡Œ10åˆ†',nav:'å½©å‡›è¯åå‹å·æ¸©æ³‰'},{icon:'ğŸ¦¢',name:'ç™½é³¥é£›ä¾†åœ°',dist:'æ­¥è¡Œ15åˆ†',nav:'åå‹å·ç™½é³¥é£›æ¥åœ°'}],price:4643},
  {id:'tokyurei',date:'2/2',nights:'1æ™š',name:'æœ­å¹Œæ±æ€¥REIé…’åº—',jp:'æ±æ€¥REIãƒ›ãƒ†ãƒ«æœ­å¹Œ',location:'åŒ—æµ·é“æœ­å¹Œå¸‚ä¸­å¤®åŒºå—4æ¡è¥¿5ä¸ç›®',room:'2é–“é›™äººæˆ¿',booking:'Klook',images:[IMG_BASE+'tokyurei-1.jpg',IMG_BASE+'tokyurei-2.jpg',IMG_BASE+'tokyurei-3.jpg'],desc:'ä½æ–¼è–„é‡ä¸­å¿ƒåœ°æ®µï¼è·é›¢ç‹¸å°è·¯æ­¥è¡Œ3åˆ†é˜ï¼Œé€›è¡—è³¼ç‰©è¶…æ–¹ä¾¿ã€‚æ¨“ä¸‹å°±æ˜¯è–„é‡å•†åœˆï¼ŒèƒèŸ¹é¤å»³ã€æ¹¯å’–å“©åº—æ­¥è¡Œå¯é”ã€‚',tags:['ğŸ³æ—©é¤','ğŸš‡äº¤é€šä¾¿åˆ©','ğŸ›ï¸è–„é‡å•†åœˆ'],nearby:[{icon:'ğŸª',name:'Lawsonä¾¿åˆ©å•†åº—',dist:'æ¨“ä¸‹',nav:'ãƒ­ãƒ¼ã‚½ãƒ³æœ­å¹Œå—å››æ¡è¥¿'},{icon:'ğŸ¦€',name:'èƒèŸ¹é¤å»³',dist:'æ­¥è¡Œ3åˆ†',nav:'ã‹ã«æ–™ç†è–„é‡'},{icon:'ğŸ›ï¸',name:'ç‹¸å°è·¯å•†åº—è¡—',dist:'æ­¥è¡Œ3åˆ†',nav:'ç‹¸å°è·¯å•†åº—è¡—'},{icon:'â„ï¸',name:'å¤§é€šå…¬åœ’é›ªç¥­',dist:'æ­¥è¡Œ10åˆ†',nav:'å¤§é€šå…¬åœ’æœ­å¹Œ'}],price:5920},
  {id:'chitose',date:'2/3',nights:'1æ™š',name:'åƒæ­²æ‚ éŠé¤¨',jp:'åƒæ­³ãƒ›ãƒ†ãƒ«éŠæ‚ é¤¨',location:'åŒ—æµ·é“åƒæ­³å¸‚åŒ—æ „2ä¸ç›®',room:'4äººä¸Šä¸‹åºŠ',booking:'EZè¨‚æˆ¿',images:[IMG_BASE+'chitose-1.jpg',IMG_BASE+'chitose-2.jpg',IMG_BASE+'chitose-3.jpg'],desc:'è·é›¢æ–°åƒæ­²æ©Ÿå ´è»Šç¨‹15åˆ†é˜ï¼Œæœ€å¾Œä¸€æ™šä½é€™æœ€æ–¹ä¾¿è¶•é£›æ©Ÿã€‚æœ‰å¤§æµ´å ´å¯æ³¡æ¹¯ã€‚',tags:['ğŸ›æµ´å ´','ğŸ…¿ï¸å…è²»åœè»Š'],no:true,nearby:[{icon:'ğŸª',name:'7-11ä¾¿åˆ©å•†åº—',dist:'æ­¥è¡Œ3åˆ†',nav:'ã‚»ãƒ–ãƒ³ã‚¤ãƒ¬ãƒ–ãƒ³åƒæ­³åŒ—æ „'},{icon:'ğŸ›’',name:'AEON Mall',dist:'æ­¥è¡Œ5åˆ†',nav:'ã‚¤ã‚ªãƒ³åƒæ­³'},{icon:'ğŸ£',name:'è¿´è½‰å£½å¸',dist:'æ­¥è¡Œ5åˆ†',nav:'å›è»¢å¯¿å¸åƒæ­³'},{icon:'âœˆï¸',name:'æ–°åƒæ­²æ©Ÿå ´',dist:'è»Šç¨‹15åˆ†',nav:'æ–°åƒæ­³ç©ºæ¸¯'}],price:4033}
];

const spots=[
  {id:'ningle',region:'å¯Œè‰¯é‡',name:'ğŸ§š ç²¾éˆéœ²å°',jp:'ãƒ‹ãƒ³ã‚°ãƒ«ãƒ†ãƒ©ã‚¹',images:[IMG_BASE+'ningle-1.jpg',IMG_BASE+'ningle-2.jpg',IMG_BASE+'ningle-3.jpg'],desc:'æ£®æ—ä¸­ç´„15é–“å¤¢å¹»å°æœ¨å±‹ã€‚å†¬å­£å¤œé–“é»ç‡ˆå¾Œå¦‚ç«¥è©±ä¸–ç•Œã€‚',address:'åŒ—æµ·é“å¯Œè‰¯é‡å¸‚ä¸­å¾¡æ–™',hours:'12:00-20:45',price:'å…è²»',tips:'å»ºè­°ä¸‹åˆ4é»å¾Œä¾†ï¼Œå¯åŒæ™‚æ‹æ—¥æ™¯å’Œå¤œé–“é»ç‡ˆã€‚',nav:'ãƒ‹ãƒ³ã‚°ãƒ«ãƒ†ãƒ©ã‚¹å¯Œè‰¯é‡'},
  {id:'biei',region:'ç¾ç‘›',name:'ğŸŒ² ç¾ç‘›åæ¨¹å·¡ç¦®',jp:'ç¾ç‘›ã®ä¸˜',images:[IMG_BASE+'biei-1.jpg',IMG_BASE+'biei-2.jpg',IMG_BASE+'biei-3.jpg'],desc:'ç¾ç‘›ä¸˜é™µä¸Šçš„ç¨ç«‹æ¨¹æœ¨ï¼Œè–èª•æ¨¹ã€Kenèˆ‡Maryä¹‹æ¨¹ã€ä¸ƒæ˜Ÿä¹‹æ¨¹ã€‚',address:'åŒ—æµ·é“ä¸Šå·éƒ¡ç¾ç‘›ç”º',hours:'å…¨å¤©',price:'å…è²»',tips:'è«‹å‹¿é€²å…¥è¾²åœ°æ‹ç…§ã€‚å†¬å­£é“è·¯æ¿•æ»‘æ³¨æ„å®‰å…¨ã€‚',nav:'ç¾ç‘›ã‚¯ãƒªã‚¹ãƒã‚¹ãƒ„ãƒªãƒ¼ã®æœ¨'},
  {id:'asahiyama',region:'æ—­å·',name:'ğŸ§ æ—­å±±å‹•ç‰©åœ’',jp:'ã‚ã•ã²ã‚„ã¾ã©ã†ã¶ã¤ãˆã‚“',images:[IMG_BASE+'asahiyama-1.jpg',IMG_BASE+'asahiyama-2.jpg',IMG_BASE+'asahiyama-3.jpg'],desc:'æ—¥æœ¬æœ€åŒ—ç«¯å‹•ç‰©åœ’ï¼Œå†¬å­£é™å®šã€Œä¼éµæ•£æ­¥ã€è¶…ç™‚ç™’ï¼æ•£æ­¥æ™‚é–“ 11:00 å’Œ 14:30 å„ä¸€å ´ã€‚',address:'åŒ—æµ·é“æ—­å·å¸‚æ±æ—­å·ç”ºå€‰æ²¼',hours:'å†¬å­£10:30-15:30',price:'Â¥1,000',tips:'ğŸ§ä¼éµæ•£æ­¥11:00ã€14:30ï¼ˆæå‰30åˆ†é˜å¡ä½ï¼‰',nav:'æ—­å±±å‹•ç‰©åœ’'},
  {id:'sounkyo',region:'å±¤é›²å³½',name:'ğŸ§Š å±¤é›²å³½å†°ç€‘ç¥­',jp:'æ°·ç€‘ã¾ã¤ã‚Š',images:[IMG_BASE+'sounkyo-1.jpg',IMG_BASE+'sounkyo-2.jpg',IMG_BASE+'sounkyo-3.jpg'],desc:'åŒ—æµ·é“ä¸‰å¤§å†¬ç¥­ï¼ç´„30åº§å†°é›•ï¼Œæ¯æ™š20:00ç…™ç«è¡¨æ¼”ï¼',address:'åŒ—æµ·é“ä¸Šå·éƒ¡ä¸Šå·ç”ºå±¤é›²å³½',hours:'17:00-21:30',price:'Â¥1,000',tips:'æœƒå ´åœ°é¢éå¸¸æ»‘ï¼å‹™å¿…ç©¿é˜²æ»‘é›ªé´ã€‚',nav:'å±¤é›²å³¡æ°·ç€‘ã¾ã¤ã‚Š'},
  {id:'kitakitsune',region:'åŒ—è¦‹',name:'ğŸ¦Š åŒ—ç‹ç‰§å ´',jp:'åŒ—ãã¤ã­ç‰§å ´',images:[IMG_BASE+'kitakitsune-1.jpg',IMG_BASE+'kitakitsune-2.jpg',IMG_BASE+'kitakitsune-3.jpg'],desc:'ç´„60éš»åŒ—æµ·é“ç‹ç‹¸è‡ªç”±æ”¾é¤Šï¼Œå†¬å­£ã€Œå†¬æ¯›ã€æœ€å¯æ„›ï¼',address:'åŒ—æµ·é“åŒ—è¦‹å¸‚ç•™è¾ºè˜‚ç”ºèŠ±ä¸˜52-1',hours:'å†¬å­£9:00-16:00',price:'Â¥500',tips:'ç¦æ­¢è§¸æ‘¸ç‹ç‹¸å’Œé¤µé£Ÿã€‚',nav:'åŒ—ãã¤ã­ç‰§å ´'},
  {id:'akan',region:'é˜¿å¯’æ¹–',name:'ğŸ£ é˜¿å¯’æ¹–å†°ä¸Šé‡£é­š',jp:'ã‚ã‹ã•ãé‡£ã‚Š',images:[IMG_BASE+'akan-1.jpg',IMG_BASE+'akan-2.jpg',IMG_BASE+'akan-3.jpg'],desc:'å†¬å­£é™å®šï¼çµå†°æ¹–é¢é‡£è¥¿å¤ªå…¬é­šï¼Œå¯ç¾å ´æ²¹ç‚¸å“åšã€‚',address:'åŒ—æµ·é“é‡§è·¯å¸‚é˜¿å¯’ç”º',hours:'8:00-16:00',price:'ç´„Â¥1,500',tips:'æ¹–ä¸Šå¾ˆå†·ï¼Œç©¿æœ€ä¿æš–çš„è¡£ç‰©ã€‚',nav:'é˜¿å¯’æ¹–'},
  {id:'rokkatei',region:'å¸¶å»£',name:'ğŸ° å…­èŠ±äº­æœ¬åº—',jp:'å…­èŠ±äº­',images:[IMG_BASE+'rokkatei-1.jpg',IMG_BASE+'rokkatei-2.jpg',IMG_BASE+'rokkatei-3.jpg'],desc:'åŒ—æµ·é“æœ€çŸ¥åç”œé»ï¼æœ¬åº—é™å®šé…¥è„†æ´¾åªæœ‰é€™è£¡åƒå¾—åˆ°ã€‚',address:'åŒ—æµ·é“å¸¶å»£å¸‚è¥¿2æ¡å—9ä¸ç›®',hours:'9:00-18:00',price:'ç´„Â¥500-2000',tips:'é…¥è„†æ´¾è³å‘³æœŸé™åªæœ‰3å°æ™‚ï¼',nav:'å…­èŠ±äº­å¸¯åºƒæœ¬åº—'},
  {id:'snowfes',region:'æœ­å¹Œ',name:'â„ï¸ æœ­å¹Œé›ªç¥­',jp:'ã•ã£ã½ã‚é›ªã¾ã¤ã‚Š',images:[IMG_BASE+'snowfes-1.jpg',IMG_BASE+'snowfes-2.jpg',IMG_BASE+'snowfes-3.jpg'],desc:'æ—¥æœ¬æœ€å¤§è¦æ¨¡é›ªç¥­ï¼å·¨å‹é›ªé›•é«˜é”15å…¬å°ºã€‚',address:'åŒ—æµ·é“æœ­å¹Œå¸‚ä¸­å¤®å€å¤§é€šå…¬åœ’',hours:'å…¨å¤©',price:'å…è²»',tips:'2026å¹´2/4-2/11èˆ‰è¾¦ï¼Œæˆ‘å€‘2/2å¯å…ˆçœ‹æº–å‚™ä¸­çš„é›ªé›•ï¼',nav:'å¤§é€šå…¬åœ’æœ­å¹Œ'},
  {id:'nakajima',region:'æœ­å¹Œ',name:'â›·ï¸ ä¸­å³¶å…¬åœ’å…è²»æ»‘é›ª',jp:'ä¸­å³¶å…¬åœ’æ­©ãã‚¹ã‚­ãƒ¼',images:[IMG_BASE+'nakajima-1.jpg',IMG_BASE+'nakajima-2.jpg',IMG_BASE+'nakajima-3.jpg'],desc:'æœ­å¹Œå¸‚å€å…§çš„å…è²»å¾’æ­¥æ»‘é›ªï¼ˆCross-country skiï¼‰é«”é©—ï¼åœ¨ä¸­å³¶å…¬åœ’é«”è‚²ä¸­å¿ƒå¯å…è²»ç§Ÿå€Ÿæ»‘é›ªç”¨å…·ï¼Œé©åˆåˆå­¸è€…ã€‚',address:'åŒ—æµ·é“æœ­å¹Œå¸‚ä¸­å¤®åŒºä¸­å³¶å…¬åœ’',hours:'10:00-16:00',price:'å…è²»ç§Ÿå€Ÿ',tips:'æ¯”tsudomeäººå°‘ï¼Œè€Œä¸”å°±åœ¨å¸‚å€å¾ˆæ–¹ä¾¿',nav:'ä¸­å³¶å…¬åœ’ä½“è‚²ã‚»ãƒ³ã‚¿ãƒ¼'},
  {id:'takino',region:'æœ­å¹Œ',name:'ğŸ¿ ç€§é‡éˆ´è˜­å…¬åœ’',jp:'æ»é‡ã™ãšã‚‰ã‚“ä¸˜é™µå…¬åœ’',images:[IMG_BASE+'takino-1.jpg',IMG_BASE+'takino-2.jpg',IMG_BASE+'takino-3.jpg'],desc:'å†¬å­£è®Šèº«æ»‘é›ªå ´ï¼æœ‰é›ªæ©‡ã€æ»‘é›ªåœˆã€é›ªé‹å¥è¡Œç­‰æ´»å‹•ã€‚ç§Ÿå€Ÿç”¨å…·é½Šå…¨ï¼Œåˆå­¸è€…ä¹Ÿèƒ½ç©ã€‚',address:'åŒ—æµ·é“æœ­å¹Œå¸‚å—åŒºæ»é‡247',hours:'9:00-16:00',price:'å…¥åœ’Â¥450/æ»‘é›ªåœˆÂ¥150',tips:'è·é›¢å¸‚å€ç´„1å°æ™‚è»Šç¨‹ï¼Œå»ºè­°å®‰æ’åŠå¤©',nav:'æ»é‡ã™ãšã‚‰ã‚“ä¸˜é™µå…¬åœ’'}
];

const itinerary=[
  {day:1,date:'1/28(ä¸‰)',title:'æŠµé”ãƒ»å¯Œè‰¯é‡',km:'123km',items:[{time:'06:20',title:'âœˆï¸ å°åŒ—å‡ºç™¼',desc:'è™èˆªIT234'},{time:'10:55',title:'ğŸ›¬ æŠµé”æ–°åƒæ­²'},{time:'11:30',title:'ğŸœ æ©Ÿå ´åˆé¤',desc:'æ©Ÿå ´æˆ–è·¯ä¸Šè²·',type:'meal'},{time:'12:30',title:'ğŸš— å–è»Šå‡ºç™¼',desc:'ç´„2å°æ™‚è»Šç¨‹'},{time:'15:40',title:'ğŸ§š ç²¾éˆéœ²å°',desc:'æˆ–ç›´æ¥å»é£¯åº—æ˜æ—©å†ä¾†',nav:'ãƒ‹ãƒ³ã‚°ãƒ«ãƒ†ãƒ©ã‚¹'},{time:'17:30',title:'ğŸ¨ å¯Œè‰¯é‡æ‹‰æ¼æ‘',type:'hotel'},{time:'18:30',title:'ğŸ½ï¸ é£¯åº—æ™šé¤',type:'meal'}]},
  {day:2,date:'1/29(å››)',title:'ç¾ç‘›ãƒ»æ—­å±±',km:'50km',items:[{time:'07:20',title:'ğŸ³ é£¯åº—æ—©é¤',type:'meal'},{time:'08:30',title:'ğŸš— å‡ºç™¼ç¾ç‘›'},{time:'09:00',title:'ğŸŒ² ç¾ç‘›åæ¨¹',desc:'ç´„1å°æ™‚',nav:'ç¾ç‘›ã‚¯ãƒªã‚¹ãƒã‚¹ãƒ„ãƒªãƒ¼'},{time:'11:00',title:'ğŸ§ æ—­å±±å‹•ç‰©åœ’',desc:'ä¼éµæ•£æ­¥11:00ã€14:30',nav:'æ—­å±±å‹•ç‰©åœ’'},{time:'12:30',title:'ğŸœ å‹•ç‰©åœ’åˆé¤',desc:'åœ’å…§é£Ÿå ‚',type:'meal'},{time:'16:00',title:'ğŸ¨ æ—­å·å®¢æ¨‚æ£®',type:'hotel'},{time:'17:00',title:'ğŸ‘ å¤§é»‘å±‹æˆå‰æ€æ±—',desc:'æ™šé¤',type:'meal',nav:'æˆå‰æ€æ±—å¤§é»’å±‹æ—­å·'},{time:'æ™šä¸Š',title:'ğŸ›ï¸ DCMè²·é‹é‡˜/é€›è¡—',nav:'DCMãƒ›ãƒ¼ãƒãƒƒã‚¯æ—­å·'}]},
  {day:3,date:'1/30(äº”)',title:'å±¤é›²å³½',km:'65km',items:[{time:'07:20',title:'ğŸ³ é£¯åº—æ—©é¤',type:'meal'},{time:'08:40',title:'ğŸš— å‡ºç™¼æˆ–é€›è¡—',desc:'å¯é€›å¹³å’Œé€šè²·ç‰©å…¬åœ’'},{time:'14:00',title:'ğŸ¨ å±¤é›²å³½æœé™½äº­',type:'hotel'},{time:'12:30',title:'ğŸœ å±¤é›²å³½åˆé¤',desc:'é£¯åº—æˆ–é™„è¿‘',type:'meal'},{time:'17:00',title:'ğŸ§Š å†°ç€‘ç¥­',desc:'é–€ç¥¨Â¥1,000(13yä»¥ä¸Š)',nav:'å±¤é›²å³¡æ°·ç€‘ã¾ã¤ã‚Š'},{time:'18:00',title:'ğŸ½ï¸ é£¯åº—æ™šé¤',type:'meal'},{time:'20:00',title:'ğŸ† ç…™ç«è¡¨æ¼”'}]},
  {day:4,date:'1/31(å…­)',title:'åŒ—ç‹ãƒ»é˜¿å¯’æ¹–',km:'156km',items:[{time:'07:20',title:'ğŸ³ é£¯åº—æ—©é¤',type:'meal'},{time:'08:40',title:'ğŸš— å‡ºç™¼åŒ—ç‹ç‰§å ´',desc:'ç´„1å°æ™‚'},{time:'10:40',title:'ğŸ¦Š åŒ—ç‹ç‰§å ´',desc:'é–€ç¥¨Â¥500',nav:'åŒ—ãã¤ã­ç‰§å ´'},{time:'14:30',title:'ğŸœ åŒ—è¦‹å¸‚æˆ–é˜¿å¯’æ¹–åˆé¤',type:'meal'},{time:'14:30',title:'ğŸ¨ æ–°é˜¿å¯’é£¯åº—',type:'hotel'},{time:'ä¸‹åˆ',title:'ğŸ£ å†°é‡£æˆ–æ„›åŠªæ‘è½',desc:'æˆ–æ˜å¤©æ—©ä¸Š',nav:'é˜¿å¯’æ¹–ã‚¢ã‚¤ãƒŒã‚³ã‚¿ãƒ³'},{time:'18:00',title:'ğŸ½ï¸ é£¯åº—æ™šé¤',type:'meal'}]},
  {day:5,date:'2/1(æ—¥)',title:'å¸¶å»£ãƒ»åå‹å·',km:'120km',items:[{time:'07:20',title:'ğŸ³ é£¯åº—æ—©é¤',type:'meal'},{time:'08:30',title:'ğŸš— å‡ºç™¼å¸¶å»£',desc:'ç´„2å°æ™‚(è‹¥å»é‡§è·¯è¦8é»å‡ºç™¼)'},{time:'12:00',title:'ğŸ· å¸¶å»£è±¬è‚‰è“‹é£¯',desc:'åˆé¤',type:'meal',nav:'ã±ã‚“ã¡ã‚‡ã†å¸¯åºƒ'},{time:'14:00',title:'ğŸ° å…­èŠ±äº­/æŸ³æœˆ',nav:'å…­èŠ±äº­å¸¯åºƒæœ¬åº—'},{time:'16:00',title:'ğŸ¨ åå‹å·Tetra',type:'hotel'},{time:'18:00',title:'ğŸœ éºµè™•ç”°æ¨‚',desc:'æ™šé¤',type:'meal',nav:'éººå‡¦ç”°æ¥½åå‹å·'},{time:'19:00',title:'ğŸ¦¢ å½©å‡œè¯å¤©éµç¥­',desc:'å…è²»åœè»Š',nav:'å½©å‡›è¯åå‹å·æ¸©æ³‰'}]},
  {day:6,date:'2/2(ä¸€)',title:'å‰å¾€æœ­å¹Œ',km:'205km',items:[{time:'07:20',title:'ğŸ³ é£¯åº—æ—©é¤',type:'meal'},{time:'08:40',title:'ğŸš— å‡ºç™¼æœ­å¹Œ',desc:'å å† ä¼‘æ¯ç«™ã€å¤•å¼µã€è¼ªåš'},{time:'12:30',title:'ğŸœ ä¼‘æ¯ç«™æˆ–æœ­å¹Œåˆé¤',type:'meal'},{time:'15:00',title:'ğŸ¨ æœ­å¹Œæ±æ€¥REI',type:'hotel'},{time:'ä¸‹åˆ',title:'â„ï¸ é›ªç¥­/é€›è¡—',nav:'å¤§é€šå…¬åœ’'},{time:'18:00',title:'ğŸ¦€ èƒèŸ¹æˆ–æ¹¯å’–å“©',desc:'è–„é‡æ™šé¤',type:'meal',nav:'ã‹ã«æ–™ç†è–„é‡'}]},
  {day:7,date:'2/3(äºŒ)',title:'æœ­å¹Œãƒ»åƒæ­²',km:'54km',items:[{time:'07:30',title:'ğŸ³ é£¯åº—æ—©é¤',type:'meal'},{time:'09:30',title:'ğŸ›ï¸ æœ­å¹Œè³¼ç‰©/ç©é›ª',desc:'ç‹¸å°è·¯ æˆ– ä¸­å³¶å…¬åœ’å…è²»æ»‘é›ª æˆ– ç€§é‡éˆ´è˜­'},{time:'12:30',title:'ğŸœ æœ­å¹Œåˆé¤',desc:'æ¹¯å’–å“©æˆ–æ‹‰éºµ',type:'meal'},{time:'15:30',title:'ğŸš— å‡ºç™¼åƒæ­²'},{time:'17:40',title:'â›½ å…ˆåŠ æ²¹å†åˆ°é£¯åº—',desc:'æ˜æ—©é‚„è»Š'},{time:'18:00',title:'ğŸ¨ åƒæ­²æ‚ éŠé¤¨',type:'hotel'},{time:'18:30',title:'ğŸ½ï¸ åƒæ­²æ™šé¤',desc:'AEONæˆ–é™„è¿‘',type:'meal',nav:'ã‚¤ã‚ªãƒ³åƒæ­³'}]},
  {day:8,date:'2/4(ä¸‰)',title:'è¿”å›å°ç£',km:'7km',items:[{time:'07:40',title:'ğŸ§³ é€€æˆ¿é‚„è»Š',desc:'ç§Ÿè»Šå…¬å¸é€æ©Ÿå ´'},{time:'08:40',title:'ğŸœ æ©Ÿå ´æ—©é¤',desc:'ä¸€å¹»æ‹‰éºµã€æ¾å°¾æˆå‰æ€æ±—',type:'meal',nav:'æ–°åƒæ­³ç©ºæ¸¯'},{time:'11:55',title:'âœˆï¸ èµ·é£›è¿”å°',desc:'è™èˆªIT235'},{time:'15:35',title:'ğŸ›¬ æŠµé”æ¡ƒåœ’'}]}
];

const foodShops=[
  {id:'airport-lunch',cat:'food',day:1,region:'æ–°åƒæ­²',name:'æ–°åƒæ­²æ©Ÿå ´åˆé¤',jp:'æ–°åƒæ­³ç©ºæ¸¯',icon:'âœˆï¸',desc:'æŠµé”å¾Œå…ˆåœ¨æ©Ÿå ´åƒåˆé¤ï¼3Fç¾é£Ÿè¡—é¸æ“‡è±å¯Œï¼šæ‹‰éºµã€æµ·é®®ä¸¼ã€æˆå‰æ€æ±—éƒ½æœ‰ã€‚æˆ–åœ¨è·¯ä¸Šä¾¿åˆ©å•†åº—è²·é£¯ç³°ã€ä¾¿ç•¶ã€‚',hours:'å„åº—ç´„10:00èµ·',budget:'Â¥800-1,500',tips:'æ™‚é–“æœ‰é™å¯é¸å¿«é€Ÿçš„æ‹‰éºµæˆ–ä¾¿ç•¶',nav:'æ–°åƒæ­³ç©ºæ¸¯',address:'åŒ—æµ·é“åƒæ­³å¸‚ç¾ã€…'},
  {id:'laterre-dinner',cat:'food',day:1,region:'å¯Œè‰¯é‡',name:'å¯Œè‰¯é‡é£¯åº—æ™šé¤',jp:'ãµã‚‰ã®ãƒ©ãƒ†ãƒ¼ãƒ«',icon:'ğŸ½ï¸',desc:'æ‹‰æ¼æ‘é…’åº—åŒ…å«æ™šé¤ï¼ä½¿ç”¨å¯Œè‰¯é‡åœ¨åœ°æ–°é®®è”¬èœå’Œé£Ÿæçš„æ–™ç†ï¼Œå¯äº«å—åŒ—æµ·é“çš„å±±çç¾å‘³ã€‚',hours:'18:00-20:00',budget:'å«åœ¨æˆ¿åƒ¹å…§',tips:'é£¯åº—æ™šé¤ï¼Œä¸ç”¨å¦å¤–æ‰¾é¤å»³',nav:'ãµã‚‰ã®ãƒ©ãƒ†ãƒ¼ãƒ«',address:'åŒ—æµ·é“ç©ºçŸ¥éƒ¡ä¸­å¯Œè‰¯é‡ç”º'},
  {id:'asahiyama-lunch',cat:'food',day:2,region:'æ—­å·',name:'æ—­å±±å‹•ç‰©åœ’åˆé¤',jp:'æ—­å±±å‹•ç‰©åœ’é£Ÿå ‚',icon:'ğŸ§',desc:'å‹•ç‰©åœ’å…§æœ‰å¤šé–“é£Ÿå ‚å’Œé¤å»³ã€‚æ¨è–¦ã€Œå‹•ç‰©åœ’ä¸­å¤®é£Ÿå ‚ã€çš„é†¬æ²¹æ‹‰éºµå’Œå’–å“©é£¯ï¼Œåƒ¹æ ¼è¦ªæ°‘åˆæ–¹ä¾¿ã€‚',hours:'10:30-15:00',budget:'Â¥700-1,000',tips:'ä¸­åˆäººå¤šï¼Œå»ºè­°11:30å‰æˆ–13:30å¾Œç”¨é¤',nav:'æ—­å±±å‹•ç‰©åœ’',address:'åŒ—æµ·é“æ—­å·å¸‚æ±æ—­å·ç”ºå€‰æ²¼'},
  {id:'daikoku',cat:'food',day:2,region:'æ—­å·',name:'å¤§é»‘å±‹æˆå‰æ€æ±—',jp:'å¤§é»’å±‹',icon:'ğŸ‘',desc:'æ—­å·è¶…äººæ°£æˆå‰æ€æ±—çƒ¤è‚‰ï¼ä½¿ç”¨æ–°é®®ç¾Šè‚‰ï¼Œè‚‰è³ªè»Ÿå«©ç„¡ç¾¶å‘³ã€‚è‡ªåŠ©å¼çƒ¤è‚‰ï¼Œæ²¾ç‰¹è£½é†¬æ±è¶…ç¾å‘³ã€‚å»ºè­°é»ç”Ÿç¾Šè‚‰ï¼ˆç”Ÿãƒ©ãƒ ï¼‰å’Œè‚©é‡Œè‚Œï¼ˆãƒ©ãƒ ãƒ­ãƒ¼ã‚¹ï¼‰ã€‚',hours:'17:00-23:00',budget:'Â¥2,000-3,000/äºº',tips:'éå¸¸ç†±é–€ï¼Œå»ºè­°17:00é–‹åº—å°±å»æ’éšŠï¼',nav:'æˆå‰æ€æ±—å¤§é»’å±‹æ—­å·',address:'åŒ—æµ·é“æ—­å·å¸‚4æ¡é€š5ä¸ç›®'},
  {id:'santouka',cat:'food',day:2,region:'æ—­å·',name:'å±±é ­ç«æ‹‰éºµæœ¬åº—',jp:'å±±é ­ç«',icon:'ğŸœ',desc:'æ—­å·ä¸‰å¤§æ‹‰éºµä¹‹ä¸€ï¼æ‹›ç‰Œæ˜¯é¹½å‘³æ‹‰éºµï¼ˆã—ãŠã‚‰ãƒ¼ã‚ã‚“ï¼‰ï¼Œæ¹¯é ­æ¿ƒéƒä½†ä¸è†©å£ï¼Œå‰ç‡’å…¥å£å³åŒ–ã€‚å¤§é»‘å±‹å‚™æ¡ˆé¸é …ã€‚',hours:'11:00-21:00',budget:'Â¥900-1,200',tips:'æœ¬åº—é™å®šçš„ç‰¹è£½å‰ç‡’å€¼å¾—ä¸€è©¦',nav:'ã‚‰ãƒ¼ã‚ã‚“å±±é ­ç«æ—­å·æœ¬åº—',address:'åŒ—æµ·é“æ—­å·å¸‚1æ¡é€š8ä¸ç›®'},
  {id:'sounkyo-lunch',cat:'food',day:3,region:'å±¤é›²å³½',name:'å±¤é›²å³½åˆé¤',jp:'å±¤é›²å³¡',icon:'ğŸœ',desc:'å±¤é›²å³½æº«æ³‰å€é¤å»³é¸æ“‡ä¸å¤šã€‚å¯åœ¨é£¯åº—å…§ç”¨é¤ï¼Œæœé™½äº­B1æœ‰æ‹‰éºµåº—ã€‚æˆ–ææ—©åˆ°é£¯åº—äº«ç”¨è¨­æ–½ã€‚',hours:'11:00-14:00',budget:'Â¥800-1,200',tips:'é™„è¿‘æ²’æœ‰ä¾¿åˆ©å•†åº—ï¼Œå»ºè­°åœ¨é£¯åº—è§£æ±º',nav:'å±¤é›²å³¡æœé™½äº­',address:'åŒ—æµ·é“ä¸Šå·éƒ¡ä¸Šå·ç”ºå±¤é›²å³¡æ¸©æ³‰'},
  {id:'sounkyo-dinner',cat:'food',day:3,region:'å±¤é›²å³½',name:'å±¤é›²å³½é£¯åº—æ™šé¤',jp:'å±¤é›²å³¡æœé™½äº­',icon:'ğŸ½ï¸',desc:'æœé™½äº­åŒ…å«è±ç››çš„è‡ªåŠ©æ™šé¤ï¼åŒ—æµ·é“æµ·é®®ã€ç‡’çƒ¤ã€å£½å¸ã€ç”œé»æ‡‰æœ‰ç›¡æœ‰ã€‚å¯é‚Šäº«ç”¨ç¾é£Ÿé‚Šæ¬£è³å±±æ™¯ã€‚',hours:'18:00-21:00',budget:'å«åœ¨æˆ¿åƒ¹å…§',tips:'å…ˆå»å†°ç€‘ç¥­å†å›ä¾†åƒæ™šé¤ä¹Ÿå¯ä»¥',nav:'å±¤é›²å³¡æœé™½äº­',address:'åŒ—æµ·é“ä¸Šå·éƒ¡ä¸Šå·ç”ºå±¤é›²å³¡æ¸©æ³‰'},
  {id:'akan-lunch',cat:'food',day:4,region:'é˜¿å¯’æ¹–',name:'é˜¿å¯’æ¹–åˆé¤',jp:'é˜¿å¯’æ¹–',icon:'ğŸœ',desc:'å¯åœ¨åŒ—è¦‹å¸‚å€æˆ–åˆ°é˜¿å¯’æ¹–å¾Œç”¨é¤ã€‚é˜¿å¯’æ¹–æº«æ³‰è¡—æœ‰å¤šé–“é¤å»³ï¼Œæ¨è–¦åšåšã€Œæ„›åŠªæ–™ç†ã€æˆ–é¹¿è‚‰æ–™ç†ã€‚',hours:'11:00-14:00',budget:'Â¥1,000-1,500',tips:'æ„›åŠªæ‘è½Kotanå…§ä¹Ÿæœ‰é¤å»³',nav:'é˜¿å¯’æ¹–æ¸©æ³‰',address:'åŒ—æµ·é“é‡§è·¯å¸‚é˜¿å¯’ç”º'},
  {id:'akan-dinner',cat:'food',day:4,region:'é˜¿å¯’æ¹–',name:'æ–°é˜¿å¯’é£¯åº—æ™šé¤',jp:'ãƒ‹ãƒ¥ãƒ¼é˜¿å¯’ãƒ›ãƒ†ãƒ«',icon:'ğŸ½ï¸',desc:'æ–°é˜¿å¯’é£¯åº—çš„è‡ªåŠ©æ™šé¤éå¸¸è±ç››ï¼ç¾çƒ¤ç‰›æ’ã€æµ·é®®ã€å£½å¸ã€å¤©å©¦ç¾…ï¼Œé‚„æœ‰åŒ—æµ·é“ç”œé»ã€‚å¯çœºæœ›é˜¿å¯’æ¹–æ™¯ã€‚',hours:'18:00-21:00',budget:'å«åœ¨æˆ¿åƒ¹å…§',tips:'æ¨è–¦åçª—é‚Šä½ç½®çœ‹æ¹–æ™¯',nav:'ãƒ‹ãƒ¥ãƒ¼é˜¿å¯’ãƒ›ãƒ†ãƒ«',address:'åŒ—æµ·é“é‡§è·¯å¸‚é˜¿å¯’ç”ºé˜¿å¯’æ¹–æ¸©æ³‰'},
  {id:'butadon',cat:'food',day:5,region:'å¸¶å»£',name:'å¸¶å»£è±¬è‚‰è“‹é£¯',jp:'è±šä¸¼',icon:'ğŸ·',desc:'å¸¶å»£åç‰©ï¼ç‚­ç«ç‡’çƒ¤çš„åšåˆ‡è±¬è‚‰ï¼Œæ·‹ä¸Šç”œé¹¹é†¬æ±ï¼Œé…ç™½é£¯è¶…ä¸‹é£¯ã€‚æ¨è–¦ååº—ï¼šã±ã‚“ã¡ã‚‡ã†ã€ã¨ã‚“ç”°ã€ã„ã£ã´ã‚“ã€‚',hours:'11:00-19:00',budget:'Â¥1,000-1,500',tips:'ã±ã‚“ã¡ã‚‡ã†æ˜¯å…ƒç¥–åº—ï¼Œæ’éšŠäººæ½®å¤š',nav:'ã±ã‚“ã¡ã‚‡ã†å¸¯åºƒ',address:'åŒ—æµ·é“å¸¯åºƒå¸‚è¥¿1æ¡å—11ä¸ç›®'},
  {id:'denraku',cat:'food',day:5,region:'åå‹å·',name:'éºµè™•ç”°æ¨‚',jp:'éººå‡¦ç”°æ¥½',icon:'ğŸœ',desc:'åå‹å·æº«æ³‰å€çš„äººæ°£æ‹‰éºµåº—ï¼ä½¿ç”¨é“ç”¢å°éº¥è£½éºµï¼Œæ¹¯é ­é¸ç”¨åå‹åœ¨åœ°é£Ÿæã€‚æ¨è–¦å‘³å™Œæ‹‰éºµå’Œè¾£å‘³å™Œæ‹‰éºµã€‚',hours:'11:00-15:00, 17:00-20:00',budget:'Â¥850-1,100',tips:'æ™šé¤æ™‚æ®µå»ºè­°å…ˆé ç´„æˆ–æ—©é»å»',nav:'éººå‡¦ç”°æ¥½åå‹å·',address:'åŒ—æµ·é“æ²³æ±éƒ¡éŸ³æ›´ç”ºåå‹å·æ¸©æ³‰'},
  {id:'sapporo-lunch',cat:'food',day:6,region:'æœ­å¹Œ',name:'æœ­å¹Œåˆé¤',jp:'æœ­å¹Œãƒ©ãƒ³ãƒ',icon:'ğŸœ',desc:'é–‹è»Šé€”ä¸­å¯åœ¨å¤•å¼µé“ä¹‹é§…ä¼‘æ¯ç”¨é¤ï¼Œæˆ–åˆ°æœ­å¹Œå¾Œå†åƒã€‚æœ­å¹Œé¸æ“‡è¶…å¤šï¼šæ‹‰éºµã€æ¹¯å’–å“©ã€æµ·é®®ä¸¼ã€‚',hours:'11:00-14:00',budget:'Â¥1,000-1,500',tips:'å¦‚æœæƒ³æ—©é»åˆ°é£¯åº—ï¼Œå¯åœ¨ä¼‘æ¯ç«™è§£æ±º',nav:'é“ã®é§…å¤•å¼µãƒ¡ãƒ­ãƒ¼ãƒ‰',address:'åŒ—æµ·é“å¤•å¼µå¸‚'},
  {id:'kani',cat:'food',day:6,region:'æœ­å¹Œ',name:'è–„é‡èƒèŸ¹æˆ–æ¹¯å’–å“©',jp:'ã‹ã«ãƒ»ã‚¹ãƒ¼ãƒ—ã‚«ãƒ¬ãƒ¼',icon:'ğŸ¦€',desc:'èƒèŸ¹æ¨è–¦ï¼šå†°é›ªä¹‹é–€ã€é›£é™€åƒåˆ°é£½ã€‚æ¹¯å’–å“©æ¨è–¦ï¼šSuage+ã€GARAKUã€å¥§èŠå•†åº—ã€‚éƒ½åœ¨è–„é‡å•†åœˆï¼Œå¯ä¾ç•¶å¤©å¿ƒæƒ…é¸æ“‡ï¼',hours:'17:00-22:00',budget:'èƒèŸ¹Â¥5,000-10,000/æ¹¯å’–å“©Â¥1,500',tips:'å»ºè­°äº‹å…ˆé ç´„èƒèŸ¹é¤å»³ï¼Œè–„é‡å€åº—å®¶å¾ˆå¤š',nav:'ã‹ã«æ–™ç†è–„é‡',address:'åŒ—æµ·é“æœ­å¹Œå¸‚ä¸­å¤®åŒºå—5æ¡'},
  {id:'soupcurry',cat:'food',day:7,region:'æœ­å¹Œ',name:'æ¹¯å’–å“©',jp:'ã‚¹ãƒ¼ãƒ—ã‚«ãƒ¬ãƒ¼',icon:'ğŸ›',desc:'æœ­å¹Œç™¼æºçš„ç‰¹è‰²æ–™ç†ï¼æ¿ƒéƒé¦™æ–™æ¹¯åº•é…å¤§å¡Šè”¬èœå’Œé›è…¿ã€‚æ¨è–¦åº—å®¶ï¼šSuage+ã€GARAKUã€å¥§èŠå•†åº—ã€‚Day7åˆé¤å¥½é¸æ“‡ï¼',hours:'11:30-21:00',budget:'Â¥1,200-1,800',tips:'è¾£åº¦å¯é¸ï¼Œå»ºè­°å¾ä¸­è¾£é–‹å§‹',nav:'ã‚¹ãƒ¼ãƒ—ã‚«ãƒ¬ãƒ¼GARAKUæœ­å¹Œ',address:'åŒ—æµ·é“æœ­å¹Œå¸‚ä¸­å¤®åŒº'},
  {id:'chitose-dinner',cat:'food',day:7,region:'åƒæ­²',name:'åƒæ­²æ™šé¤',jp:'åƒæ­³ãƒ‡ã‚£ãƒŠãƒ¼',icon:'ğŸ½ï¸',desc:'æ‚ éŠé¤¨é™„è¿‘æœ‰AEON Mallï¼Œç¾é£Ÿè¡—é¸æ“‡å¤šã€‚ä¹Ÿå¯ä»¥å»è¿´è½‰å£½å¸ã€æ‹‰éºµåº—ã€‚æœ€å¾Œä¸€æ™šè¼•é¬†åƒï¼',hours:'17:00-21:00',budget:'Â¥1,000-2,000',tips:'AEONæ­¥è¡Œ5åˆ†é˜ï¼Œå¾ˆæ–¹ä¾¿',nav:'ã‚¤ã‚ªãƒ³åƒæ­³',address:'åŒ—æµ·é“åƒæ­³å¸‚æ „ç”º'},
  {id:'airport',cat:'food',day:8,region:'æ–°åƒæ­²',name:'æ–°åƒæ­²æ©Ÿå ´æ—©é¤',jp:'æ–°åƒæ­³ç©ºæ¸¯ã‚°ãƒ«ãƒ¡',icon:'âœˆï¸',desc:'æœ€å¾Œçš„åŒ—æµ·é“ç¾é£Ÿï¼æ¨è–¦ï¼šä¸€å¹»æ‹‰éºµï¼ˆè¦å‘³è¶…æ¿ƒï¼‰ã€æ¾å°¾æˆå‰æ€æ±—ã€èŠ±ç•‘ç‰§å ´ç”œé»ã€Royceå·§å…‹åŠ›ã€‚',hours:'å„åº—ç´„8:00èµ·',budget:'Â¥1,000-2,000',tips:'åœ‹å…§ç·š3Fç¾é£Ÿæœ€å¤šï¼Œå»ºè­°é ç•™1.5å°æ™‚',nav:'æ–°åƒæ­³ç©ºæ¸¯',address:'åŒ—æµ·é“åƒæ­³å¸‚ç¾ã€…'},
  {id:'dcm',cat:'shop',day:2,region:'æ—­å·',name:'DCM (è²·é‹é‡˜)',jp:'DCMãƒ›ãƒ¼ãƒãƒƒã‚¯',icon:'ğŸ”§',desc:'åŒ—æµ·é“é€£é–äº”é‡‘ç™¾è²¨ï¼å†¬å­£å¿…è²·ï¼šé‹åº•é˜²æ»‘é‡˜ï¼ˆç´„Â¥500-1,000ï¼‰ã€æš–æš–åŒ…ã€é™¤é›ªç”¨å“ã€‚é‹é‡˜è£åœ¨é‹åº•ï¼Œèµ°å†°é›ªè·¯é¢è¶…å®‰å…¨ï¼',hours:'9:00-21:00',budget:'Â¥500-2,000',tips:'é‹é‡˜åœ¨ã€Œé´ç”¨å“ã€å€ï¼Œåº—å“¡æœƒå¹«å¿™å®‰è£',nav:'DCMãƒ›ãƒ¼ãƒãƒƒã‚¯æ—­å·å¤§é›ªé€šåº—',address:'åŒ—æµ·é“æ—­å·å¸‚å¤§é›ªé€š5ä¸ç›®'},
  {id:'aeon',cat:'shop',day:2,region:'æ—­å·',name:'AEONè³¼ç‰©ä¸­å¿ƒ',jp:'ã‚¤ã‚ªãƒ³æ—­å·é§…å‰',icon:'ğŸ›’',desc:'æ—­å·è»Šç«™æ—çš„å¤§å‹è³¼ç‰©ä¸­å¿ƒï¼è¶…å¸‚å¯è²·é›¶é£ŸåœŸç”¢ï¼Œè—¥å¦åº—å¯è£œè²¨ã€‚ç¾é£Ÿè¡—ä¹Ÿå¾ˆæ–¹ä¾¿ã€‚',hours:'9:00-21:00',budget:'ä¾è³¼è²·å…§å®¹',tips:'1Fè¶…å¸‚å¯è²·ä¾¿å®œæ°´æœå’Œä¾¿ç•¶',nav:'ã‚¤ã‚ªãƒ³æ—­å·é§…å‰',address:'åŒ—æµ·é“æ—­å·å¸‚å®®ä¸‹é€š7ä¸ç›®'},
  {id:'tanukikoji',cat:'shop',day:6,region:'æœ­å¹Œ',name:'ç‹¸å°è·¯å•†åº—è¡—',jp:'ç‹¸å°è·¯å•†åº—è¡—',icon:'ğŸ›ï¸',desc:'æœ­å¹Œæœ€ç†±é¬§çš„å•†åº—è¡—ï¼å…¨é•·ç´„900mæœ‰é ‚æ£šã€‚è—¥å¦åº—ï¼ˆæ¾æœ¬æ¸…ã€å¤§åœ‹è—¥å¦ï¼‰ã€åœŸç”¢åº—ã€é¤å»³æ‡‰æœ‰ç›¡æœ‰ã€‚',hours:'10:00-21:00(å„åº—ä¸åŒ)',budget:'ä¾è³¼è²·å…§å®¹',tips:'1-3ä¸ç›®è—¥å¦æœ€ä¾¿å®œï¼Œ5-6ä¸ç›®æœ‰ç‰¹è‰²å°åº—',nav:'ç‹¸å°è·¯å•†åº—è¡—',address:'åŒ—æµ·é“æœ­å¹Œå¸‚ä¸­å¤®åŒºå—2-3æ¡'},
  {id:'odori',cat:'shop',day:6,region:'æœ­å¹Œ',name:'å¤§é€šå…¬åœ’åœ°ä¸‹è¡—',jp:'ã‚ªãƒ¼ãƒ­ãƒ©ã‚¿ã‚¦ãƒ³',icon:'ğŸ¬',desc:'å¤§é€šå…¬åœ’åœ°ä¸‹çš„è³¼ç‰©è¡—ï¼é€£æ¥åœ°éµç«™ï¼Œä¸‹é›ªå¤©ä¹Ÿèƒ½èˆ’é©è³¼ç‰©ã€‚æœé£¾ã€é›œè²¨ã€å’–å•¡å»³éƒ½æœ‰ã€‚',hours:'10:00-21:00',budget:'ä¾è³¼è²·å…§å®¹',tips:'é€£æ¥ä¸‰è¶Šã€PARCOç­‰ç™¾è²¨',nav:'ã‚ªãƒ¼ãƒ­ãƒ©ã‚¿ã‚¦ãƒ³æœ­å¹Œ',address:'åŒ—æµ·é“æœ­å¹Œå¸‚ä¸­å¤®åŒºå¤§é€šè¥¿'},
  {id:'chitoseaeon',cat:'shop',day:7,region:'åƒæ­²',name:'AEON Mallåƒæ­²',jp:'ã‚¤ã‚ªãƒ³åƒæ­³',icon:'ğŸ›’',desc:'åƒæ­²æœ€å¤§è³¼ç‰©ä¸­å¿ƒï¼æœ€å¾Œæ¡è³¼åœŸç”¢çš„å¥½åœ°æ–¹ã€‚è¶…å¸‚ã€è—¥å¦ã€ç™¾å…ƒåº—éƒ½æœ‰ï¼Œé‚„æœ‰ç¾é£Ÿè¡—ã€‚',hours:'9:00-21:00',budget:'ä¾è³¼è²·å…§å®¹',tips:'è·é›¢é£¯åº—æ­¥è¡Œ5åˆ†ï¼Œå¾ˆæ–¹ä¾¿',nav:'ã‚¤ã‚ªãƒ³åƒæ­³åº—',address:'åŒ—æµ·é“åƒæ­³å¸‚æ „ç”º6ä¸ç›®'}
];

const phrases=[
  {cat:'driving',jp:'ã‚¬ã‚½ãƒªãƒ³ã‚¹ã‚¿ãƒ³ãƒ‰ã¯ã©ã“ã§ã™ã‹ï¼Ÿ',ro:'Gasorin sutando wa doko desu ka?',zh:'åŠ æ²¹ç«™åœ¨å“ªè£¡ï¼Ÿ'},
  {cat:'driving',jp:'ãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼æº€ã‚¿ãƒ³ã§',ro:'RegyurÄ mantan de',zh:'è«‹åŠ æ»¿ä¸€èˆ¬æ±½æ²¹'},
  {cat:'restaurant',jp:'å››äººã§ã™',ro:'Yonin desu',zh:'å››å€‹äºº'},
  {cat:'restaurant',jp:'ãŠã™ã™ã‚ã¯ï¼Ÿ',ro:'Osusume wa?',zh:'æ¨è–¦ä»€éº¼ï¼Ÿ'},
  {cat:'restaurant',jp:'ãŠä¼šè¨ˆ',ro:'Okaikei',zh:'è«‹çµå¸³'},
  {cat:'onsen',jp:'æ¸©æ³‰ã¯ã©ã“ã§ã™ã‹ï¼Ÿ',ro:'Onsen wa doko desu ka?',zh:'æº«æ³‰åœ¨å“ªè£¡ï¼Ÿ'},
  {cat:'shopping',jp:'å…ç¨ã§ãã¾ã™ã‹ï¼Ÿ',ro:'Menzei dekimasu ka?',zh:'å¯ä»¥å…ç¨…å—ï¼Ÿ'},
  {cat:'emergency',jp:'åŠ©ã‘ã¦',ro:'Tasukete',zh:'æ•‘å‘½'}
];

function initCarousel(id){
  const c=document.querySelector(`[data-carousel="${id}"]`);if(!c)return;
  const inner=c.querySelector('.carousel-inner'),dots=c.querySelectorAll('.carousel-dot'),counter=c.querySelector('.carousel-counter'),total=c.querySelectorAll('.carousel-slide').length;
  let cur=0;
  function goTo(i){if(i<0)i=total-1;if(i>=total)i=0;cur=i;inner.style.transform=`translateX(-${cur*100}%)`;dots.forEach((d,j)=>d.classList.toggle('active',j===cur));if(counter)counter.textContent=`${cur+1}/${total}`;}
  c.querySelector('.prev')?.addEventListener('click',()=>goTo(cur-1));
  c.querySelector('.next')?.addEventListener('click',()=>goTo(cur+1));
  dots.forEach((d,i)=>d.addEventListener('click',()=>goTo(i)));
  let startX=0;
  inner.addEventListener('touchstart',e=>startX=e.touches[0].clientX);
  inner.addEventListener('touchend',e=>{const diff=startX-e.changedTouches[0].clientX;if(Math.abs(diff)>50)diff>0?goTo(cur+1):goTo(cur-1);});
  setInterval(()=>goTo(cur+1),6000);
}

function init(){
  setupNav();renderDaySelector();renderDay(1);renderHotels();renderSpots();renderFood();renderTransport();renderPhraseTabs();renderPhrases();renderBudgetPage();
  fetchWeather(currentDay);
  setInterval(()=>fetchWeather(currentDay),300000);
  if(API_URL){document.getElementById('setup-section').innerHTML='';syncData();}else renderSetup();
}

async function fetchWeather(day){
  const loc=dayLocations.find(l=>l.day===day);
  if(!loc)return;
  try{
    // ä½¿ç”¨ Open-Meteo API (å…è²»ã€ç„¡éœ€ API Key)
    const url=`https://api.open-meteo.com/v1/forecast?latitude=${loc.lat}&longitude=${loc.lon}&current=temperature_2m,relative_humidity_2m,apparent_temperature,precipitation,weather_code,wind_speed_10m,wind_gusts_10m&hourly=precipitation_probability,snowfall&daily=sunrise,sunset,weather_code,temperature_2m_max,temperature_2m_min,precipitation_sum,snowfall_sum&timezone=Asia/Tokyo&forecast_days=3`;
    const res=await fetch(url);
    const data=await res.json();
    weatherData=data;
    lastWeatherUpdate=new Date();
    renderWeather(day,data,loc);
  }catch(e){
    console.error('Weather fetch error:',e);
    renderWeatherError();
  }
}

function getWeatherIcon(code){
  // WMO Weather Code å°ç…§
  if(code===0)return 'â˜€ï¸';
  if(code<=3)return 'â›…';
  if(code<=49)return 'ğŸŒ«ï¸';
  if(code<=59)return 'ğŸŒ§ï¸';
  if(code<=69)return 'ğŸŒ¨ï¸';
  if(code<=79)return 'â„ï¸';
  if(code<=99)return 'â›ˆï¸';
  return 'ğŸŒ¥ï¸';
}

function getWeatherDesc(code){
  if(code===0)return 'æ™´æœ—';
  if(code<=3)return 'å¤šé›²';
  if(code<=49)return 'éœ§';
  if(code<=55)return 'æ¯›æ¯›é›¨';
  if(code<=59)return 'é›¨';
  if(code<=65)return 'é›¨';
  if(code<=69)return 'é›¨å¤¾é›ª';
  if(code<=75)return 'é™é›ª';
  if(code<=79)return 'é›ªç²’';
  if(code<=82)return 'é™£é›¨';
  if(code<=86)return 'å¤§é›ª';
  if(code<=99)return 'é›·é›¨';
  return 'å¤šé›²';
}

function renderWeather(day,data,loc){
  const current=data.current;
  const daily=data.daily;
  const hourly=data.hourly;
  
  // è¨ˆç®—æœªä¾†6å°æ™‚é™é›ªæ©Ÿç‡å’Œé™é›ªé‡
  const snowfall6h=hourly.snowfall.slice(0,6).reduce((a,b)=>a+(b||0),0);
  
  // åˆ¤æ–·è­¦ç¤ºç­‰ç´š
  let alertLevel='safe',alertMsg='';
  if(snowfall6h>=10){alertLevel='danger';alertMsg=`âš ï¸ å¤§é›ªè­¦å ±ï¼6hrå…§é™é›ª ${snowfall6h.toFixed(1)}cmï¼Œè«‹ç‰¹åˆ¥æ³¨æ„`;}
  else if(snowfall6h>=3){alertLevel='warn';alertMsg=`ğŸŒ¨ï¸ é™é›ªæ³¨æ„ï¼š6hrå…§é è¨ˆ ${snowfall6h.toFixed(1)}cm`;}
  else if(current.wind_gusts_10m>=50){alertLevel='warn';alertMsg=`ğŸ’¨ å¼·é¢¨æ³¨æ„ï¼šé™£é¢¨ ${current.wind_gusts_10m.toFixed(0)}km/h`;}
  else if(current.temperature_2m<=-10){alertLevel='info';alertMsg=`ğŸ¥¶ æ¥µå¯’ ${current.temperature_2m}Â°Cï¼Œæ³¨æ„è·¯é¢çµå†°`;}
  else{alertLevel='safe';alertMsg=`âœ… è·¯æ³æ­£å¸¸ï¼Œä¿æŒå®‰å…¨è»Šè·`;}
  
  const sunrise=daily.sunrise[0].split('T')[1];
  const sunset=daily.sunset[0].split('T')[1];
  const updateTime=lastWeatherUpdate.toLocaleTimeString('zh-TW',{hour:'2-digit',minute:'2-digit'});
  
  document.getElementById('weather-box').innerHTML=`
    <div class="weather-card">
      <div class="weather-header">
        <div class="weather-title">${getWeatherIcon(current.weather_code)} ${loc.name} ${getWeatherDesc(current.weather_code)}</div>
        <div class="weather-update">${updateTime} æ›´æ–°</div>
      </div>
      <div class="weather-alert ${alertLevel}">${alertMsg}</div>
      <div class="weather-grid">
        <div class="weather-item"><div class="weather-label">ğŸŒ¡ï¸ æ°£æº«</div><div class="weather-value cold">${current.temperature_2m}Â°C</div></div>
        <div class="weather-item"><div class="weather-label">ğŸ¥¶ é«”æ„Ÿ</div><div class="weather-value cold">${current.apparent_temperature}Â°C</div></div>
        <div class="weather-item"><div class="weather-label">â„ï¸ 6hré›ª</div><div class="weather-value ${snowfall6h>=3?'warn':''}">${snowfall6h.toFixed(1)}cm</div></div>
        <div class="weather-item"><div class="weather-label">ğŸ’¨ é¢¨é€Ÿ</div><div class="weather-value">${current.wind_speed_10m}km/h</div></div>
        <div class="weather-item"><div class="weather-label">ğŸŒ… æ—¥å‡º</div><div class="weather-value">${sunrise}</div></div>
        <div class="weather-item"><div class="weather-label">ğŸŒ‡ æ—¥è½</div><div class="weather-value">${sunset}</div></div>
      </div>
      <div class="road-status">
        <div class="road-title"><span>ğŸ›£ï¸ ç›¸é—œé“è·¯</span><a href="https://northern-road.ceri.go.jp/navi/" target="_blank" class="road-link">åŒ—ã®é“ãƒŠãƒ“ â†’</a></div>
        <div>${loc.roads.map(r=>`<span class="road-item"><span class="road-dot unknown"></span>${r}</span>`).join('')}</div>
      </div>
    </div>`;
}

function renderWeatherError(){
  document.getElementById('weather-box').innerHTML=`
    <div class="weather-card">
      <div class="weather-header"><div class="weather-title">ğŸŒ¤ï¸ å¤©æ°£è³‡è¨Š</div></div>
      <div class="weather-alert info">ğŸ“¡ ç„¡æ³•å–å¾—å¤©æ°£ï¼Œè«‹æª¢æŸ¥ç¶²è·¯</div>
    </div>`;
}

function setupNav(){document.querySelectorAll('.nav-item').forEach(item=>{item.addEventListener('click',()=>{document.querySelectorAll('.nav-item').forEach(i=>i.classList.remove('active'));document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));item.classList.add('active');document.getElementById('page-'+item.dataset.page).classList.add('active');});});}
function renderDaySelector(){document.getElementById('day-selector').innerHTML=itinerary.map(d=>`<div class="day-btn ${d.day===1?'active':''}" onclick="selectDay(${d.day})"><div class="day-btn-num">${d.day}</div><div class="day-btn-date">${d.date.split('(')[0]}</div></div>`).join('');}
function selectDay(day){currentDay=day;document.querySelectorAll('.day-btn').forEach((b,i)=>b.classList.toggle('active',i+1===day));renderDay(day);fetchWeather(day);}
function renderDay(day){const d=itinerary.find(i=>i.day===day);document.getElementById('day-content').innerHTML=`<div class="card"><div class="card-header"><div class="card-title">Day ${d.day} ï½œ ${d.title}</div><div class="card-sub">${d.date} ãƒ» ${d.km}</div></div><div class="card-body"><div class="timeline">${d.items.map(item=>`<div class="tl-item ${item.type||''}"><div class="tl-dot"></div><div class="tl-time">${item.time}</div><div class="tl-title">${item.title}</div>${item.desc?`<div class="tl-desc">${item.desc}</div>`:''}${item.nav?`<a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.nav)}" target="_blank" class="tl-link">ğŸ“ å°èˆª</a>`:''}</div>`).join('')}</div></div></div>`;}

function renderHotels(){
  document.getElementById('page-hotels').innerHTML=hotels.map(h=>`
    <div class="hotel-card">
      <div class="carousel" data-carousel="hotel-${h.id}">
        <div class="carousel-inner">${h.images.map((img,i)=>`<div class="carousel-slide"><img src="${img}" alt="${h.name}" onerror="this.parentElement.innerHTML='<div style=\\'display:flex;align-items:center;justify-content:center;height:100%;background:linear-gradient(135deg,#e1bee7,#ce93d8);color:#7b1fa2;font-size:13px;text-align:center;padding:16px\\'>ğŸ“· ä¸Šå‚³åœ–ç‰‡<br>${h.id}-${i+1}.jpg</div>'"></div>`).join('')}</div>
        <button class="carousel-btn prev">â®</button><button class="carousel-btn next">â¯</button>
        <div class="carousel-dots">${h.images.map((_,i)=>`<span class="carousel-dot ${i===0?'active':''}"></span>`).join('')}</div>
        <div class="carousel-counter">1/${h.images.length}</div>
      </div>
      <div class="hotel-header ${h.warn?'warn':''}"><div class="hotel-date">ğŸ“… ${h.date} ${h.nights}</div><div class="hotel-name">${h.name}</div></div>
      <div class="hotel-body">
        <div class="hotel-info">ğŸ·ï¸ ${h.jp}<br>ğŸ“ ${h.location}<br>ğŸ›ï¸ ${h.room}<br>ğŸ“± ${h.booking}${h.extra?`<br>ğŸ’´ ${h.extra}`:''}</div>
        <div class="hotel-desc">${h.desc}</div>
        <div class="hotel-tags">${h.tags.map(t=>`<span class="hotel-tag ${h.warn?'warn':''} ${h.no?'no':''}">${t}</span>`).join('')}</div>
        <div class="hotel-nearby"><div class="hotel-nearby-title">ğŸ“ å‘¨é‚Šè¨­æ–½</div>${h.nearby.map(n=>`<div class="nearby-item"><span class="nearby-icon">${n.icon}</span><span class="nearby-name">${n.name}</span><span class="nearby-dist">${n.dist}</span>${n.nav?`<a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(n.nav)}" target="_blank" class="nearby-nav">å°èˆª</a>`:''}</div>`).join('')}</div>
        <div class="hotel-price"><span class="hotel-price-label">${h.warn?'é ä¼°':'æˆ¿åƒ¹'}</span><span class="hotel-price-value">NT$${h.price.toLocaleString()}${h.priceNote?`<span style="font-size:12px;font-weight:400;color:var(--gray);display:block">(${h.priceNote})</span>`:''}</span></div>
        <div style="display:flex;gap:10px;margin-top:14px"><a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(h.location)}" target="_blank" class="hotel-nav-btn" style="flex:1;margin-top:0">ğŸ“ å°èˆª</a><button onclick="showBooking('${h.id}')" class="hotel-nav-btn" style="flex:1;margin-top:0;background:linear-gradient(135deg,var(--blue),var(--navy));border:none;cursor:pointer">ğŸ“„ è¨‚è³¼å–®</button></div>
      </div>
    </div>`).join('');
  setTimeout(()=>hotels.forEach(h=>initCarousel('hotel-'+h.id)),100);
}

function renderSpots(){
  document.getElementById('page-spots').innerHTML=spots.map(s=>`
    <div class="spot-card">
      <div class="carousel" data-carousel="spot-${s.id}">
        <div class="carousel-inner">${s.images.map((img,i)=>`<div class="carousel-slide"><img src="${img}" alt="${s.name}" onerror="this.parentElement.innerHTML='<div style=\\'display:flex;align-items:center;justify-content:center;height:100%;background:linear-gradient(135deg,#e3f2fd,#bbdefb);color:#1976d2;font-size:13px;text-align:center;padding:16px\\'>ğŸ“· ä¸Šå‚³åœ–ç‰‡<br>${s.id}-${i+1}.jpg</div>'"></div>`).join('')}</div>
        <button class="carousel-btn prev">â®</button><button class="carousel-btn next">â¯</button>
        <div class="carousel-dots">${s.images.map((_,i)=>`<span class="carousel-dot ${i===0?'active':''}"></span>`).join('')}</div>
        <div class="carousel-counter">1/${s.images.length}</div>
      </div>
      <div class="spot-body">
        <span class="spot-region">${s.region}</span><div class="spot-name">${s.name}</div><div class="spot-jp">${s.jp}</div>
        <div class="spot-desc">${s.desc}</div>
        <div class="spot-info-grid"><div class="spot-info-item"><div class="spot-info-label">ç‡Ÿæ¥­</div><div class="spot-info-value">${s.hours}</div></div><div class="spot-info-item"><div class="spot-info-label">è²»ç”¨</div><div class="spot-info-value">${s.price}</div></div><div class="spot-info-item" style="grid-column:span 2"><div class="spot-info-label">åœ°å€</div><div class="spot-info-value">${s.address}</div></div></div>
        <div class="spot-tips"><div class="spot-tips-title">ğŸ’¡ å°æé†’</div><div class="spot-tips-content">${s.tips}</div></div>
        <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(s.nav)}" target="_blank" class="spot-nav-btn">ğŸ“ é–‹å•Ÿå°èˆª</a>
      </div>
    </div>`).join('');
  setTimeout(()=>spots.forEach(s=>initCarousel('spot-'+s.id)),100);
}

let currentFoodFilter='all';
function renderFood(){
  const foodList=currentFoodFilter==='all'?foodShops:foodShops.filter(f=>f.cat===currentFoodFilter);
  document.getElementById('page-food').innerHTML=`
    <div class="food-tabs">
      <div class="food-tab ${currentFoodFilter==='all'?'active':''}" onclick="filterFood('all')">ğŸ½ï¸ å…¨éƒ¨</div>
      <div class="food-tab ${currentFoodFilter==='food'?'active':''}" onclick="filterFood('food')">ğŸœ ç¾é£Ÿ</div>
      <div class="food-tab shop ${currentFoodFilter==='shop'?'active':''}" onclick="filterFood('shop')">ğŸ›ï¸ è³¼ç‰©</div>
    </div>
    <div id="food-list">${foodList.map(f=>`
      <div class="food-card">
        <div class="food-header ${f.cat==='shop'?'shop':''}">
          <div class="food-icon">${f.icon}</div>
          <div class="food-title">
            <div class="food-name">${f.name}</div>
            <div class="food-jp">${f.jp}</div>
          </div>
          <div class="food-day">Day${f.day} ${f.region}</div>
        </div>
        <div class="food-body">
          <div class="food-desc">${f.desc}</div>
          <div class="food-info">
            <div class="food-info-item"><div class="food-info-label">â° ç‡Ÿæ¥­æ™‚é–“</div><div class="food-info-value">${f.hours}</div></div>
            <div class="food-info-item"><div class="food-info-label">ğŸ’° é ç®—</div><div class="food-info-value">${f.budget}</div></div>
          </div>
          <div class="food-tips">ğŸ’¡ ${f.tips}</div>
          <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(f.nav)}" target="_blank" class="food-nav-btn">ğŸ“ é–‹å•Ÿå°èˆª</a>
        </div>
      </div>`).join('')}
    </div>`;
}
function filterFood(cat){currentFoodFilter=cat;renderFood();}

const restStops=[
  {day:1,route:'æ–°åƒæ­²â†’å¯Œè‰¯é‡',km:123,stops:[{name:'é“ã®é§… ä¸‰ç¬ ',dist:'ç´„60kmè™•',time:'ç´„1å°æ™‚',feature:'åŒ—æµ·é“ç¬¬1è™Ÿé“ä¹‹é§…ã€æº«æ³‰è¨­æ–½ã€è‡ªè£½å†°æ·‡æ·‹',nav:'é“ã®é§…ä¸‰ç¬ '}]},
  {day:2,route:'ç¾ç‘›â†’æ—­å±±',km:50,stops:[]},
  {day:3,route:'æ—­å·â†’å±¤é›²å³½',km:65,stops:[{name:'é“ã®é§… ã¨ã†ã¾ (ç•¶éº»)',dist:'ç´„20kmè™•',time:'ç´„25åˆ†',feature:'ç•¶åœ°è¾²ç”¢å“ã€ä¼‘æ¯ç©ºé–“',nav:'é“ã®é§…ã¨ã†ã¾'}]},
  {day:4,route:'å±¤é›²å³½â†’åŒ—ç‹ç‰§å ´â†’é˜¿å¯’æ¹–',km:156,stops:[{name:'é“ã®é§… ãŠã‚“ã­ã‚†æ¸©æ³‰',dist:'ç´„80kmè™•(åŒ—ç‹ç‰§å ´æ—)',time:'ç´„1.5å°æ™‚',feature:'ä¸–ç•Œæœ€å¤§é³©æ™‚è¨ˆã€å±±ä¹‹æ°´æ—é¤¨ã€ç™½èŠ±è±†å†°æ·‡æ·‹',nav:'é“ã®é§…ãŠã‚“ã­ã‚†æ¸©æ³‰'}]},
  {day:5,route:'é˜¿å¯’æ¹–â†’å¸¶å»£â†’åå‹å·',km:120,stops:[{name:'é“ã®é§… ã‚ã—ã‚‡ã‚éŠ€æ²³ãƒ›ãƒ¼ãƒ«21',dist:'ç´„60kmè™•',time:'ç´„1å°æ™‚',feature:'æ¾å±±åƒæ˜¥ç´€å¿µé¤¨ã€å¤©æ–‡å±•ç¤º',nav:'é“ã®é§…ã‚ã—ã‚‡ã‚éŠ€æ²³ãƒ›ãƒ¼ãƒ«21'}]},
  {day:6,route:'åå‹å·â†’æœ­å¹Œ',km:205,stops:[{name:'é“ã®é§… å¤•å¼µãƒ¡ãƒ­ãƒ¼ãƒ‰',dist:'ç´„120kmè™•',time:'ç´„1.5å°æ™‚',feature:'å¤•å¼µå“ˆå¯†ç“œã€å“ˆå¯†ç“œç”œé»',nav:'é“ã®é§…å¤•å¼µãƒ¡ãƒ­ãƒ¼ãƒ‰'},{name:'é“æ±é“ å å† PA',dist:'ç´„80kmè™•',time:'ç´„1å°æ™‚',feature:'é«˜é€Ÿå…¬è·¯ä¼‘æ¯å€',nav:'å å† ãƒ‘ãƒ¼ã‚­ãƒ³ã‚°ã‚¨ãƒªã‚¢'}]},
  {day:7,route:'æœ­å¹Œâ†’åƒæ­²',km:54,stops:[]},
  {day:8,route:'åƒæ­²â†’æ©Ÿå ´',km:7,stops:[]}
];
function renderTransport(){document.getElementById('page-transport').innerHTML=`<div class="trans-box"><div class="trans-title">âœˆï¸ èˆªç­è³‡è¨Š</div><div class="trans-row"><span class="trans-label">èˆªç©ºå…¬å¸</span><span class="trans-value">å°ç£è™èˆª</span></div><div class="trans-row" style="flex-direction:column;gap:8px"><span class="trans-label">å»ç¨‹ IT234 ãƒ» 1/28(ä¸‰)</span><div style="display:flex;justify-content:space-between;font-size:14px"><span>TPE 06:20</span><span style="color:var(--light)">âœˆ 3h35m</span><span>CTS 10:55</span></div></div><div class="trans-row" style="flex-direction:column;gap:8px"><span class="trans-label">å›ç¨‹ IT235 ãƒ» 2/4(ä¸‰)</span><div style="display:flex;justify-content:space-between;font-size:14px"><span>CTS 11:55</span><span style="color:var(--light)">âœˆ 3h40m</span><span>TPE 15:35</span></div></div><div style="margin-top:12px;padding:12px;background:#f8f9fa;border-radius:10px;font-size:13px"><div style="margin-bottom:8px;font-weight:600">ğŸ“‹ è¨‚ä½ä»£è™Ÿ</div><div style="display:flex;justify-content:space-between;margin-bottom:4px"><span>V4GLGV (2äºº)</span><span>NT$43,962</span></div><div style="display:flex;justify-content:space-between;margin-bottom:4px"><span>L5YVFC (1äºº)</span><span>NT$22,110</span></div><div style="display:flex;justify-content:space-between"><span>W9STQG (1äºº)</span><span>NT$20,210</span></div></div><div class="trans-row"><span class="trans-label">æ©Ÿç¥¨ç¸½åƒ¹</span><span class="trans-value red">NT$86,282</span></div></div><div class="trans-box"><div class="trans-title">ğŸš— ç§Ÿè»Šè³‡è¨Š</div><div class="trans-row"><span class="trans-label">ç§Ÿè»Šå…¬å¸</span><span class="trans-value">èªŒéºŸå§å§</span></div><div class="trans-row" style="flex-direction:column;align-items:flex-start;gap:4px"><span class="trans-label">è»Šå‹</span><span style="font-weight:600;font-size:14px">è±ç”° NOAH / VOXY<br><span style="font-size:12px;color:var(--gray)">7äººåº§æ²¹è»Šãƒ»å››è¼ªå‚³å‹•</span></span></div><div class="trans-row"><span class="trans-label">å–è»Š</span><span class="trans-value">1/28(ä¸‰) 12:00</span></div><div class="trans-row"><span class="trans-label">é‚„è»Š</span><span class="trans-value">2/3(äºŒ) 19:00å‰</span></div><div class="trans-row"><span class="trans-label">å¤©æ•¸</span><span class="trans-value">7å¤©(æ—¥åˆ¶)</span></div><div style="margin:12px 0;padding:12px;background:#e8f5e9;border-radius:10px;font-size:13px;color:#2e7d32"><div style="font-weight:600;margin-bottom:6px">âœ… è²»ç”¨åŒ…å«</div>å…¨éšªCDW+NOCç‡Ÿæ¥­è£œå„Ÿãƒ»å››è¼ªå‚³å‹•ãƒ»JAFé“è·¯æ•‘æ´</div><div style="margin:0 0 12px;padding:12px;background:#e3f2fd;border-radius:10px;font-size:13px;color:#1565c0"><div style="font-weight:600;margin-bottom:6px">ğŸ’° è²»ç”¨æ˜ç´°</div><div style="display:flex;justify-content:space-between;margin-bottom:4px"><span>ç§Ÿè»Š Â¥12,800Ã—7å¤©</span><span>Â¥89,600</span></div><div style="display:flex;justify-content:space-between;margin-bottom:4px"><span>HEPé«˜é€Ÿå…¬è·¯Pass</span><span>Â¥13,500</span></div><div style="display:flex;justify-content:space-between;font-weight:700;padding-top:8px;border-top:1px dashed #90caf9"><span>åˆè¨ˆ</span><span>Â¥103,100</span></div></div><div style="margin:0 0 12px;padding:12px;background:#fff3e0;border-radius:10px;font-size:13px;color:#e65100;border:2px solid #ffb74d"><div style="font-weight:700;margin-bottom:4px">â›½ é‚„è»Šæ²¹é‡æé†’</div>æ²¹å‰©ä¸€åŠæ™‚çœ‹åŠ æ²¹ç«™ï¼é‚„è»Šå‰è¨˜å¾—åŠ æ»¿æ²¹</div><div class="trans-row"><span class="trans-label">ç§Ÿè»Šç¸½åƒ¹</span><span class="trans-value red">Â¥103,100</span></div></div><div class="trans-box"><div class="trans-title">ğŸ—ºï¸ æ¯æ—¥è·¯ç·š</div><table class="route-table"><thead><tr><th>æ—¥</th><th>è·¯ç·š</th><th>km</th></tr></thead><tbody>${itinerary.map(d=>`<tr><td>${d.day}</td><td>${d.title}</td><td>${d.km.replace('km','')}</td></tr>`).join('')}</tbody><tfoot><tr><td colspan="2">ç¸½è¨ˆ</td><td>780km</td></tr></tfoot></table></div><div class="trans-box" style="margin-top:16px;border:2px solid var(--orange);background:#fffaf0"><div class="trans-title" style="color:var(--orange)">ğŸ…¿ï¸ å»ºè­°ä¼‘æ¯ç«™ (è¶…é50kmè·¯æ®µ)</div><div style="font-size:13px;color:var(--gray);margin-bottom:12px">é•·é€”é§•é§›è«‹é©æ™‚ä¼‘æ¯ï¼Œå»ºè­°æ¯1-1.5å°æ™‚åœé ä¸€æ¬¡</div>${restStops.filter(r=>r.km>=50&&r.stops.length>0).map(r=>`<div style="margin-bottom:16px;padding-bottom:16px;border-bottom:1px dashed #e0e0e0"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px"><span style="font-weight:700;color:var(--navy)">Day${r.day} ${r.route}</span><span style="background:var(--orange);color:#fff;padding:2px 8px;border-radius:10px;font-size:12px">${r.km}km</span></div>${r.stops.map(s=>`<div style="background:#fff;border-radius:10px;padding:12px;margin-top:8px;border-left:3px solid var(--green)"><div style="font-weight:600;font-size:15px;margin-bottom:6px">ğŸ…¿ï¸ ${s.name}</div><div style="font-size:13px;color:var(--gray);line-height:1.8">ğŸ“ ä½ç½®ï¼š${s.dist}<br>â±ï¸ è»Šç¨‹ï¼šç´„${s.time}<br>âœ¨ ç‰¹è‰²ï¼š${s.feature}</div><a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(s.nav)}" target="_blank" style="display:inline-flex;align-items:center;gap:4px;margin-top:8px;padding:8px 14px;background:var(--green);color:#fff;border-radius:20px;text-decoration:none;font-size:13px;font-weight:500">ğŸ“ å°èˆªå‰å¾€</a></div>`).join('')}</div>`).join('')}</div>`;}
function renderPhraseTabs(){document.getElementById('phrase-tabs').innerHTML=[{id:'all',label:'å…¨éƒ¨'},{id:'driving',label:'ğŸš—è‡ªé§•'},{id:'restaurant',label:'ğŸ½ï¸é¤å»³'},{id:'onsen',label:'â™¨ï¸æº«æ³‰'},{id:'shopping',label:'ğŸ›ï¸è³¼ç‰©'},{id:'emergency',label:'ğŸ†˜ç·Šæ€¥'}].map(t=>`<div class="phrase-tab ${t.id==='all'?'active':''}" onclick="filterPhrases('${t.id}')">${t.label}</div>`).join('');}
function filterPhrases(cat){currentPhraseFilter=cat;document.querySelectorAll('.phrase-tab').forEach(t=>t.classList.remove('active'));event.target.classList.add('active');renderPhrases();}
function renderPhrases(){const f=currentPhraseFilter==='all'?phrases:phrases.filter(p=>p.cat===currentPhraseFilter);document.getElementById('phrases-list').innerHTML=f.map(p=>`<div class="phrase-card ${p.cat}" onclick="speak('${p.jp}')"><div class="phrase-jp">${p.jp}</div><div class="phrase-romaji">${p.ro}</div><div class="phrase-zh">${p.zh}</div><div class="phrase-play">ğŸ”Š é»æ“Šæ’­æ”¾</div></div>`).join('');}
function speak(t){if('speechSynthesis'in window){const u=new SpeechSynthesisUtterance(t);u.lang='ja-JP';u.rate=0.8;speechSynthesis.speak(u);showToast('ğŸ”Š æ’­æ”¾ä¸­');}}
function renderSetup(){document.getElementById('setup-section').innerHTML=`<div class="setup-card"><div class="setup-title">âš™ï¸ è¨­å®š Google Sheets</div><div class="setup-steps">1. å»ºç«‹ Google Sheet<br>2. æ“´å……åŠŸèƒ½ â†’ Apps Script<br>3. è²¼ä¸Šç¨‹å¼ç¢¼ä¸¦éƒ¨ç½²<br>4. ç¶²å€è²¼åˆ°ä¸‹æ–¹</div><input type="text" class="setup-input" id="api-url" placeholder="è²¼ä¸Šç¶²å€..."><div class="setup-btns"><button class="setup-btn primary" onclick="saveApiUrl()">ğŸ’¾ å„²å­˜</button><button class="setup-btn secondary" onclick="testConnection()">ğŸ”— æ¸¬è©¦</button></div><div class="setup-status" id="setup-status" style="display:none"></div></div>`;}
function renderBudgetPage(){document.getElementById('budget-grid').innerHTML=`<div class="budget-card"><div class="budget-icon">âœˆï¸</div><div class="budget-label">æ©Ÿç¥¨</div><div class="budget-value" id="b-flight">NT$0</div></div><div class="budget-card"><div class="budget-icon">ğŸ¨</div><div class="budget-label">ä½å®¿</div><div class="budget-value" id="b-hotel">NT$0</div></div><div class="budget-card"><div class="budget-icon">ğŸš—</div><div class="budget-label">ç§Ÿè»Š</div><div class="budget-value" id="b-car">Â¥0</div></div><div class="budget-card"><div class="budget-icon">ğŸ½ï¸</div><div class="budget-label">é¤é£²</div><div class="budget-value" id="b-food">NT$0</div></div><div class="budget-card"><div class="budget-icon">ğŸ«</div><div class="budget-label">é–€ç¥¨</div><div class="budget-value" id="b-ticket">NT$0</div></div><div class="budget-card total"><div class="budget-icon">ğŸ’³</div><div class="budget-label">ç¸½è¨ˆ</div><div class="budget-value" id="b-total">NT$0</div></div>`;document.getElementById('expense-cats').innerHTML=[{id:'all',label:'å…¨éƒ¨',bg:'#e3f2fd',c:'#1976d2'},{id:'flight',label:'âœˆï¸',bg:'#e3f2fd',c:'#1976d2'},{id:'hotel',label:'ğŸ¨',bg:'#f3e5f5',c:'#7b1fa2'},{id:'car',label:'ğŸš—',bg:'#e8f5e9',c:'#2e7d32'},{id:'food',label:'ğŸ½ï¸',bg:'#fff3e0',c:'#ef6c00'},{id:'ticket',label:'ğŸ«',bg:'#fce4ec',c:'#c2185b'}].map(c=>`<span class="expense-cat ${c.id==='all'?'active':''}" style="background:${c.bg};color:${c.c}" onclick="filterExpenses('${c.id}')">${c.label}</span>`).join('');}
function filterExpenses(cat){currentExpenseFilter=cat;document.querySelectorAll('.expense-cat').forEach(c=>c.classList.remove('active'));event.target.classList.add('active');renderExpenses();}
function renderExpenses(){const f=currentExpenseFilter==='all'?expenses:expenses.filter(e=>e.category===currentExpenseFilter);const icons={flight:'âœˆï¸',hotel:'ğŸ¨',car:'ğŸš—',food:'ğŸ½ï¸',ticket:'ğŸ«',shopping:'ğŸ›ï¸',other:'ğŸ“¦'};const colors={flight:'#e3f2fd',hotel:'#f3e5f5',car:'#e8f5e9',food:'#fff3e0',ticket:'#fce4ec',shopping:'#e0f7fa',other:'#eceff1'};if(f.length===0){document.getElementById('expense-list').innerHTML='<div class="expense-empty">æ²’æœ‰è¨˜éŒ„</div>';return;}document.getElementById('expense-list').innerHTML=f.map(e=>`<div class="expense-item"><div class="expense-left"><div class="expense-icon" style="background:${colors[e.category]||'#eceff1'}">${icons[e.category]||'ğŸ“¦'}</div><div><div class="expense-desc">${e.description}</div><div class="expense-date">${e.date}</div></div></div><div class="expense-amount ${e.currency.toLowerCase()}">${e.currency==='TWD'?'NT$':'Â¥'}${Number(e.amount).toLocaleString()}</div><button class="expense-delete" onclick="deleteExpense('${e.id}')">ğŸ—‘ï¸</button></div>`).join('');}
function updateBudget(){const rate=0.21;let t={flight:0,hotel:0,car:0,food:0,ticket:0};expenses.forEach(e=>{const amt=e.currency==='TWD'?Number(e.amount):Math.round(Number(e.amount)*rate);if(t[e.category]!==undefined)t[e.category]+=amt;});let carJPY=0;expenses.filter(e=>e.category==='car').forEach(e=>{if(e.currency==='JPY')carJPY+=Number(e.amount);else carJPY+=Math.round(Number(e.amount)/rate);});const total=Object.values(t).reduce((a,b)=>a+b,0);document.getElementById('b-flight').textContent=`NT$${t.flight.toLocaleString()}`;document.getElementById('b-hotel').textContent=`NT$${t.hotel.toLocaleString()}`;document.getElementById('b-car').textContent=`Â¥${carJPY.toLocaleString()}`;document.getElementById('b-food').textContent=`NT$${t.food.toLocaleString()}`;document.getElementById('b-ticket').textContent=`NT$${t.ticket.toLocaleString()}`;document.getElementById('b-total').textContent=`NT$${total.toLocaleString()}`;}
function renderInfo(){document.getElementById('page-info').innerHTML=`<div class="info-card"><div class="info-header">ğŸš¨ ç·Šæ€¥é›»è©±</div><div class="emergency-box"><h4>è­¦å¯Ÿ</h4><p>110</p></div><div class="emergency-box" style="background:#ff6d00"><h4>æ¶ˆé˜²/æ•‘è­·</h4><p>119</p></div></div><div class="info-card"><div class="info-header">ğŸŒ¡ï¸ å¤©æ°£åƒè€ƒ</div><div class="info-body"><div class="info-row"><span class="info-label">å¯Œè‰¯é‡</span><span class="info-value">-15~-5Â°C</span></div><div class="info-row"><span class="info-label">å±¤é›²å³½</span><span class="info-value">-18~-8Â°C</span></div><div class="info-row"><span class="info-label">é˜¿å¯’æ¹–</span><span class="info-value">-20~-10Â°C</span></div><div class="info-row"><span class="info-label">æœ­å¹Œ</span><span class="info-value">-8~0Â°C</span></div></div></div><div class="info-card"><div class="info-header">ğŸ’¡ å¯¦ç”¨è³‡è¨Š</div><div class="info-body"><div class="info-row"><span class="info-label">åŒ¯ç‡</span><span class="info-value">Â¥100â‰ˆNT$21</span></div><div class="info-row"><span class="info-label">é›»å£“</span><span class="info-value">100V</span></div><div class="info-row"><span class="info-label">å…ç¨…</span><span class="info-value">åŒåº—æ»¿Â¥5,000</span></div></div></div><div class="info-card"><div class="info-header">ğŸš— é›ªé§•æ³¨æ„</div><div class="info-body"><div class="info-row"><span class="info-label">é€Ÿåº¦</span><span class="info-value">æ…¢20-30%</span></div><div class="info-row"><span class="info-label">ç…è»Š</span><span class="info-value">ææ—©è¼•è¸©</span></div><div class="info-row"><span class="info-label">åœè»Š</span><span class="info-value">ä¸æ”¾æ‰‹ç…è»Š</span></div></div></div>`;}
function saveApiUrl(){const url=document.getElementById('api-url').value.trim();if(!url){showSetupStatus('è«‹è¼¸å…¥','error');return;}API_URL=url;localStorage.setItem(STORAGE_KEY,url);showSetupStatus('å·²å„²å­˜','success');testConnection();}
async function testConnection(){if(!API_URL){showSetupStatus('è«‹å…ˆè¼¸å…¥','error');return;}updateConnStatus('loading');try{const r=await fetch(`${API_URL}?action=get`);const d=await r.json();if(d.success){isOnline=true;updateConnStatus('online');showSetupStatus(`æˆåŠŸï¼${d.expenses.length}ç­†`,'success');document.getElementById('setup-section').innerHTML='';if(d.expenses.length===0)initDefaultData();else{expenses=d.expenses;renderExpenses();updateBudget();}}else throw new Error();}catch(e){isOnline=false;updateConnStatus('error');showSetupStatus('é€£ç·šå¤±æ•—','error');}}
async function initDefaultData(){try{const r=await fetch(`${API_URL}?action=init`);const d=await r.json();if(d.success){showToast('å·²åˆå§‹åŒ–','success');syncData();}}catch(e){}}
async function syncData(){if(!API_URL)return;document.getElementById('header-sync').classList.add('loading');try{const r=await fetch(`${API_URL}?action=get`);const d=await r.json();if(d.success){expenses=d.expenses;isOnline=true;updateConnStatus('online');renderExpenses();updateBudget();showToast('åŒæ­¥æˆåŠŸ','success');}else throw new Error();}catch(e){isOnline=false;updateConnStatus('error');showToast('åŒæ­¥å¤±æ•—','error');}finally{document.getElementById('header-sync').classList.remove('loading');}}
function updateConnStatus(s){const el=document.getElementById('conn-status');if(s==='online'){el.className='expense-status online';el.innerHTML='<span>ğŸŸ¢</span> å·²é€£ç·š';}else if(s==='error'){el.className='expense-status error';el.innerHTML='<span>ğŸ”´</span> é›¢ç·š';}else{el.className='expense-status offline';el.innerHTML='<span>â³</span> é€£ç·šä¸­...';}}
function showSetupStatus(msg,type){const el=document.getElementById('setup-status');if(el){el.style.display='block';el.className='setup-status '+type;el.textContent=msg;}}
function openModal(){if(!isOnline){showToast('è«‹å…ˆè¨­å®š','error');return;}document.getElementById('modal').classList.add('active');document.getElementById('f-date').value=new Date().toISOString().split('T')[0];}
function closeModal(){document.getElementById('modal').classList.remove('active');}
async function addExpense(e){e.preventDefault();const btn=document.getElementById('submit-btn');btn.disabled=true;btn.textContent='æ–°å¢ä¸­...';const params=new URLSearchParams({action:'add',id:Date.now().toString(),date:document.getElementById('f-date').value,category:document.getElementById('f-cat').value,description:document.getElementById('f-desc').value,currency:document.getElementById('f-cur').value,amount:document.getElementById('f-amt').value});try{const r=await fetch(`${API_URL}?${params}`);const d=await r.json();if(d.success){showToast('æ–°å¢æˆåŠŸ','success');closeModal();document.querySelector('form').reset();syncData();}else throw new Error();}catch(e){showToast('æ–°å¢å¤±æ•—','error');}finally{btn.disabled=false;btn.textContent='æ–°å¢æ¶ˆè²»';}}
async function deleteExpense(id){if(!confirm('ç¢ºå®šåˆªé™¤ï¼Ÿ'))return;try{const r=await fetch(`${API_URL}?action=delete&id=${id}`);const d=await r.json();if(d.success){showToast('å·²åˆªé™¤','success');syncData();}else throw new Error();}catch(e){showToast('åˆªé™¤å¤±æ•—','error');}}
function showToast(msg,type=''){const t=document.getElementById('toast');t.textContent=msg;t.className='toast show '+type;setTimeout(()=>t.className='toast',2500);}
function showBooking(hotelId){
  const modal=document.getElementById('booking-modal');
  const content=document.getElementById('booking-content');
  const multipleBookings={asahikawa:2};
  const count=multipleBookings[hotelId]||1;
  let html='';
  if(count===1){
    html=`<img id="booking-img-0" src="${IMG_BASE}booking-${hotelId}.jpg" alt="è¨‚è³¼å–®" style="max-width:100%;border-radius:12px;box-shadow:0 2px 12px rgba(0,0,0,.1)" onerror="this.style.display='none';document.getElementById('booking-placeholder-0').style.display='block'">
    <div id="booking-placeholder-0" style="display:none;padding:40px 20px;color:var(--gray)">
      <div style="font-size:48px;margin-bottom:12px">ğŸ“·</div>
      <div style="font-size:15px;margin-bottom:8px">å°šæœªä¸Šå‚³è¨‚è³¼å–®æˆªåœ–</div>
      <div style="font-size:13px;color:var(--light)">è«‹å°‡æˆªåœ–å‘½åç‚º <strong>booking-${hotelId}.jpg</strong><br>æ”¾å…¥ images è³‡æ–™å¤¾</div>
    </div>`;
  }else{
    for(let i=1;i<=count;i++){
      html+=`<div style="margin-bottom:16px;${i>1?'padding-top:16px;border-top:2px dashed #e0e0e0':''}">
        <div style="font-size:14px;font-weight:600;color:var(--blue);margin-bottom:10px">ğŸ“„ è¨‚è³¼å–® ${i}</div>
        <img src="${IMG_BASE}booking-${hotelId}-${i}.jpg" alt="è¨‚è³¼å–®${i}" style="max-width:100%;border-radius:12px;box-shadow:0 2px 12px rgba(0,0,0,.1)" onerror="this.style.display='none';this.nextElementSibling.style.display='block'">
        <div style="display:none;padding:30px 20px;color:var(--gray);background:#f8f9fa;border-radius:12px">
          <div style="font-size:36px;margin-bottom:8px">ğŸ“·</div>
          <div style="font-size:14px;margin-bottom:6px">å°šæœªä¸Šå‚³è¨‚è³¼å–® ${i}</div>
          <div style="font-size:12px;color:var(--light)">æª”åï¼š<strong>booking-${hotelId}-${i}.jpg</strong></div>
        </div>
      </div>`;
    }
  }
  content.innerHTML=html;
  modal.classList.add('active');
}
function closeBookingModal(){document.getElementById('booking-modal').classList.remove('active');}
document.getElementById('booking-modal').addEventListener('click',e=>{if(e.target.id==='booking-modal')closeBookingModal();});
document.getElementById('modal').addEventListener('click',e=>{if(e.target.id==='modal')closeModal();});
document.addEventListener('DOMContentLoaded',init);
</script>
</body>
</html>
